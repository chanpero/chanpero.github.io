

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/Myfavicon.ico">
  <link rel="icon" href="/img/Myfavicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="chanper">
  <meta name="keywords" content="">
  
    <meta name="description" content="MySQL 学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL-笔记">
<meta property="og:url" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name">
<meta property="og:description" content="MySQL 学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/DQL%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MySQL%E6%9E%B6%E6%9E%84%E5%9B%BE.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MySQL%E5%BC%95%E6%93%8E%E5%88%97%E8%A1%A8.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/B-Tree.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/B+Tree.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MySQL_B+Tree.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/Hash%E7%B4%A2%E5%BC%95.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%9D%9E%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E6%9F%A5%E8%AF%A2.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E6%9F%A5%E8%AF%A2.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E7%B4%A2%E5%BC%95%E7%BB%84%E7%BB%87%E8%A1%A8.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%88%86%E8%A3%821.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%88%86%E8%A3%822.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%90%88%E5%B9%B61.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%90%88%E5%B9%B62.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/cascade_cp.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/local_cp.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/redo_log.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/undo_log_%E7%89%88%E6%9C%AC%E9%93%BE.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E6%8B%86%E5%88%86%E7%AD%96%E7%95%A5.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MyCat%E6%A6%82%E5%BF%B5%E5%9B%BE.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MyCat%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E4%B8%BB%E4%BB%8E%E5%88%86%E7%A6%BB%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E5%8F%8C%E4%B8%BB%E5%8F%8C%E4%BB%8E%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="article:published_time" content="2022-12-03T07:23:02.000Z">
<meta property="article:modified_time" content="2022-12-18T09:12:12.595Z">
<meta property="article:author" content="chanper">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://chanpero.github.io/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B.png">
  
  
  
  <title>MySQL-笔记 </title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"chanpero.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"e6fbf52343bffac933f91eae00e480dc","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"1InH4XckKf2mHSUQuLHRajZH-gzGzoHsz","app_key":"jDwLBVwoqcNPXW57ymIDicVB","server_url":"https://1inh4xck.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?e6fbf52343bffac933f91eae00e480dc";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>chanper</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" false
     style="background: url('/img/banner.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MySQL-笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-03 15:23" pubdate>
          2022年12月3日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          48k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          404 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL-笔记</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><h2 id="MySQL-概述"><a href="#MySQL-概述" class="headerlink" title="MySQL 概述"></a>MySQL 概述</h2><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="left">简介</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DB</td>
<td align="left">存储数据的仓库，对数据进行有组织的存储</td>
</tr>
<tr>
<td align="center">DBMS</td>
<td align="left">操纵和管理数据库的大型软件</td>
</tr>
<tr>
<td align="center">SQL</td>
<td align="left">操作关系型数据库的编程语言，定义了一套操作关系型数据库的统一标准</td>
</tr>
</tbody></table>
<ul>
<li>关系型数据库：建立在关系模型基础上，由多张相互连接的二维表，即由行和列组成的表，构成的数据库</li>
</ul>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B.png" srcset="/img/loading.gif" lazyload class="" title="alt 数据模型">

<p>启动MySQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs SQL"># 启停MySQL服务<br>net <span class="hljs-keyword">start</span> mysql80<br>net stop mysql80<br><br># 连接MySQL<br>mysql [<span class="hljs-operator">-</span>h <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>] [<span class="hljs-operator">-</span>P <span class="hljs-number">3306</span>] <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br>参数：<br><span class="hljs-operator">-</span>h : MySQL服务所在的主机IP<br><span class="hljs-operator">-</span>P : MySQL服务端口号， 默认<span class="hljs-number">3306</span><br><span class="hljs-operator">-</span>u : MySQL数据库用户名<br><span class="hljs-operator">-</span>p ： MySQL数据库用户名对应的密码<br></code></pre></td></tr></table></figure>


<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="left">全称</th>
<th align="left">简介</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DDL</td>
<td align="left">Data Definition Language</td>
<td align="left">数据定义语言，用来定义数据库对象，如数据库、表、字段</td>
</tr>
<tr>
<td align="center">DML</td>
<td align="left">Data Manipulation Language</td>
<td align="left">数据操作语言，用来对数据库表中的数据进行增删改</td>
</tr>
<tr>
<td align="center">DQL</td>
<td align="left">Data Query Language</td>
<td align="left">数据查询语言，用来查询数据库中表的记录</td>
</tr>
<tr>
<td align="center">DCL</td>
<td align="left">Data Control Language</td>
<td align="left">数据控制语言，用来创建数据库用户、控制数据库的控制权限</td>
</tr>
</tbody></table>
<h3 id="DDL-数据定义语言"><a href="#DDL-数据定义语言" class="headerlink" title="DDL - 数据定义语言"></a>DDL - 数据定义语言</h3><h4 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h4><ul>
<li>查询所有数据库:<br><code>show databases;</code></li>
<li>查询当前数据库：<br><code>select database();</code>  </li>
<li>创建数据库：<br><code>create database [if not exists] 数据库名 [default charset 字符集] [collate 排序规则]</code> </li>
<li>删除数据库:<br><code>drop database [if exists] 数据库名;</code>  </li>
<li>切换数据库：<br><code>use 数据库名;</code></li>
</ul>
<p>注：UTF8字符集长度为3字节，有些符号占4字节，所以推荐用utf8mb4字符集</p>
<h4 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h4><ul>
<li>查询当前数据库所有表：<br><code>show tables;</code>  </li>
<li>查询表结构：<br><code>desc 表名;</code>  </li>
<li>查询指定表的建表语句：<br><code>show create table 表名;</code>  </li>
<li>创建表：  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名(<br>    字段<span class="hljs-number">1</span> 字段<span class="hljs-number">1</span>类型 [COMMENT 字段<span class="hljs-number">1</span>注释],<br>    字段<span class="hljs-number">2</span> 字段<span class="hljs-number">2</span>类型 [COMMENT 字段<span class="hljs-number">2</span>注释],<br>    字段<span class="hljs-number">3</span> 字段<span class="hljs-number">3</span>类型 [COMMENT 字段<span class="hljs-number">3</span>注释],<br>    ...<br>    字段n 字段n类型 [COMMENT 字段n注释]<br>)[ COMMENT 表注释 ];<br></code></pre></td></tr></table></figure></li>
<li>修改表名：<br><code>ALTER TABLE 表名 RENAME TO 新表名</code></li>
<li>删除表：<br><code>DROP TABLE [IF EXISTS] 表名;</code></li>
<li>删除表，并重新创建该表，相当于删除表中所有数据：<br><code>TRUNCATE TABLE 表名;</code></li>
</ul>
<h4 id="字段操作"><a href="#字段操作" class="headerlink" title="字段操作"></a>字段操作</h4><ul>
<li><p>添加字段：<br><code>ALTER TABLE 表名 ADD 字段名 类型(长度) [COMMENT 注释] [约束];</code><br>例：<code>ALTER TABLE emp ADD nickname varchar(20) COMMENT &#39;昵称&#39;;</code></p>
</li>
<li><p>修改数据类型：<br><code>ALTER TABLE 表名 MODIFY 字段名 新数据类型(长度);</code></p>
</li>
<li><p>修改字段名和字段类型：<br><code>ALTER TABLE 表名 CHANGE 旧字段名 新字段名 类型(长度) [COMMENT 注释] [约束];</code><br>例：将emp表的nickname字段修改为username，类型为varchar(30)<br><code>ALTER TABLE emp CHANGE nickname username varchar(30) COMMENT &#39;昵称&#39;;</code>  </p>
</li>
<li><p>删除字段：<br><code>ALTER TABLE 表名 DROP 字段名;</code></p>
</li>
</ul>
<h3 id="DML-数据操作语言"><a href="#DML-数据操作语言" class="headerlink" title="DML - 数据操作语言"></a>DML - 数据操作语言</h3><h4 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h4><ul>
<li><p>指定字段：<br><code>INSERT INTO 表名 (字段名1, 字段名2, ...) VALUES (值1, 值2, ...);</code>  </p>
</li>
<li><p>全部字段：<br><code>INSERT INTO 表名 VALUES (值1, 值2, ...);</code>  </p>
</li>
<li><p>批量添加数据：<br><code>INSERT INTO 表名 (字段名1, 字段名2, ...) VALUES (值1, 值2, ...), (值1, 值2, ...), (值1, 值2, ...);</code><br><code>INSERT INTO 表名 VALUES (值1, 值2, ...), (值1, 值2, ...), (值1, 值2, ...);</code></p>
</li>
</ul>
<p>注：</p>
<ul>
<li>插入数据时，指定的字段顺序需要与值的顺序是一一对应的</li>
<li>字符串和日期类型数据应该包含在引号中</li>
<li>插入的数据大小应该在字段的规定范围内</li>
</ul>
<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><p><code>UPDATE 表名 SET 字段名1 = 值1, 字段名2 = 值2, ... [ WHERE 条件 ];</code><br>例：<br><code>UPDATE employee SET name = &#39;小昭&#39;, gender = &#39;女&#39; where id = 1;</code></p>
<p>注: 没有条件语句则会修改整张表的所有数据</p>
<h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><p><code>DELETE FROM 表名 [ WHERE 条件 ];</code><br>例：<br><code>delete from employee where gender = &#39;女&#39;;</code></p>
<p>注：</p>
<ul>
<li>没有条件语句则会删除整张表的所有数据</li>
<li>DELETE语句不能删除某一个字段的值(可以使用UPDATE，将该字段值置为NULL即可)</li>
</ul>
<h3 id="DQL-数据查询语言"><a href="#DQL-数据查询语言" class="headerlink" title="DQL - 数据查询语言"></a>DQL - 数据查询语言</h3><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span><br>	字段列表<br><span class="hljs-keyword">FROM</span><br>	表名字段<br><span class="hljs-keyword">WHERE</span><br>	条件列表<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span><br>	分组字段列表<br><span class="hljs-keyword">HAVING</span><br>	分组后的条件列表<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span><br>	排序字段列表<br>LIMIT<br>	分页参数<br></code></pre></td></tr></table></figure>

<h4 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h4><ul>
<li><p>查询多个字段：<br><code>SELECT 字段1, 字段2, 字段3, ... FROM 表名;</code><br><code>SELECT * FROM 表名;</code><br>注：* 表示查询所有字段，不直观且影响效率</p>
</li>
<li><p>设置别名：<br><code>SELECT 字段1 [ AS 别名1 ], 字段2 [ AS 别名2 ], ... FROM 表名;</code><br><code>SELECT 字段1 [ 别名1 ], 字段2 [ 别名2 ], ... FROM 表名;</code>  </p>
</li>
<li><p>去除重复记录：<br><code>SELECT DISTINCT 字段列表 FROM 表名;</code></p>
</li>
</ul>
<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><p>语法：<br><code>SELECT 字段列表 FROM 表名 WHERE 条件列表;</code>  </p>
<p>条件:</p>
<table>
<thead>
<tr>
<th>比较运算符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>等于</td>
</tr>
<tr>
<td>&lt;&gt; 或 !&#x3D;</td>
<td>不等于</td>
</tr>
<tr>
<td>BETWEEN … AND …</td>
<td>在某个范围内（含最小、最大值）</td>
</tr>
<tr>
<td>IN(…)</td>
<td>在in之后的列表中的值，多选一</td>
</tr>
<tr>
<td>LIKE 占位符</td>
<td>模糊匹配（_匹配单个字符，%匹配任意个字符）</td>
</tr>
<tr>
<td>IS NULL</td>
<td>是NULL</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>逻辑运算符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>AND 或 &amp;&amp;</td>
<td>并且（多个条件同时成立）</td>
</tr>
<tr>
<td>OR 或 &amp;#124;&amp;#124;</td>
<td>或者（多个条件任意一个成立）</td>
</tr>
<tr>
<td>NOT 或 !</td>
<td>非，不是</td>
</tr>
</tbody></table>
<p>例：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 没有身份证</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> idcard <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">or</span> idcard <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-comment">-- 有身份证</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> idcard;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> idcard <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-comment">-- 年龄在20到30之间</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">20</span> <span class="hljs-keyword">and</span> <span class="hljs-number">30</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">20</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">30</span>;<br><span class="hljs-comment">-- 下面语句不报错，但查不到任何信息</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> <span class="hljs-number">20</span>;<br><span class="hljs-comment">-- 性别为女且年龄小于30</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span>;<br><span class="hljs-comment">-- 年龄等于25或30或35</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">30</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">35</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-keyword">in</span> (<span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">35</span>);<br><span class="hljs-comment">-- 姓名为两个字</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;__&#x27;</span>;<br><span class="hljs-comment">-- 身份证最后为X</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> idcard <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%X&#x27;</span>;<br></code></pre></td></tr></table></figure>


<h4 id="聚合查询（聚合函数）"><a href="#聚合查询（聚合函数）" class="headerlink" title="聚合查询（聚合函数）"></a>聚合查询（聚合函数）</h4><p>将一列数据作为一个整体，进行纵向计算。常见聚合函数有：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>count</td>
<td>统计数量</td>
</tr>
<tr>
<td>max</td>
<td>最大值</td>
</tr>
<tr>
<td>min</td>
<td>最小值</td>
</tr>
<tr>
<td>avg</td>
<td>平均值</td>
</tr>
<tr>
<td>sum</td>
<td>求和</td>
</tr>
</tbody></table>
<p>语法：<br><code>SELECT 聚合函数(字段列表) FROM 表名;</code><br>例：<br><code>SELECT count(id) from employee where workaddress = &quot;广东省&quot;;</code><br>注：</p>
<ul>
<li>如果指定列，那么该列的NULL值不参与所有的聚合函数运算</li>
<li>对于count聚合函数，统计符合条件的总记录数，还可以通过 count(数字&#x2F;字符串)的形式进行统计查询</li>
</ul>
<h4 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h4><p>语法：<br><code>SELECT 字段列表 FROM 表名 [ WHERE 条件 ] GROUP BY 分组字段名 [ HAVING 分组后的过滤条件 ];</code>  </p>
<p>注：</p>
<ul>
<li>where 和 having 的区别：<ul>
<li>执行时机不同：where是分组之前进行过滤，不满足where条件不参与分组；having是分组后对结果进行过滤。</li>
<li>判断条件不同：where不能对聚合函数进行判断，而having可以</li>
</ul>
</li>
<li>分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义</li>
<li>执行顺序: where -&gt; 聚合函数 -&gt; having</li>
<li>支持多字段分组, 具体语法为 : group by columnA, columnB</li>
</ul>
<p>例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 根据性别分组，统计男性和女性数量</span><br><span class="hljs-keyword">select</span> gender, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender;<br><span class="hljs-comment">-- 年龄小于45，并根据工作地址分组</span><br><span class="hljs-keyword">select</span> workaddress, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">45</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> workaddress;<br><span class="hljs-comment">-- 年龄小于45，并根据工作地址分组，获取员工数量大于等于3的工作地址</span><br><span class="hljs-keyword">select</span> workaddress, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) address_count <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">45</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> workaddress <span class="hljs-keyword">having</span> address_count <span class="hljs-operator">&gt;=</span> <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>


<h4 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h4><p>语法：<br><code>SELECT 字段列表 FROM 表名 ORDER BY 字段1 排序方式1, 字段2 排序方式2;</code></p>
<p>注：</p>
<ul>
<li>排序方式：<ul>
<li>ASC: 升序（默认）</li>
<li>DESC: 降序</li>
</ul>
</li>
<li>如果是多字段排序，当第一个字段值相同时，才会根据第二个字段进行排序</li>
</ul>
<p>例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 两字段排序，根据年龄升序排序，入职时间降序排序(如果年龄相同那么就按这个)</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">ASC</span>, entrydate <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure>

<h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><p>语法：<br><code>SELECT 字段列表 FROM 表名 LIMIT 起始索引, 查询记录数;</code>  </p>
<p>注：</p>
<ul>
<li>起始索引从0开始，起始索引 &#x3D; （查询页码 - 1） * 每页显示记录数</li>
<li>分页查询是数据库的方言，不同数据库有不同实现，MySQL是LIMIT</li>
<li>如果查询的是第一页数据，起始索引可以省略，直接简写 LIMIT 10</li>
</ul>
<p>例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询第一页数据，展示10条</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee LIMIT <span class="hljs-number">10</span>;<br><span class="hljs-comment">-- 查询第二页</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee LIMIT <span class="hljs-number">10</span>, <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure>


<h4 id="DQL执行顺序"><a href="#DQL执行顺序" class="headerlink" title="DQL执行顺序"></a>DQL执行顺序</h4><p><strong>FROM -&gt; WHERE -&gt; GROUP BY -&gt; HAVING -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</strong></p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/DQL%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png" srcset="/img/loading.gif" lazyload class="" title="alt DQL执行顺序">


<h3 id="DCL-数据控制语言"><a href="#DCL-数据控制语言" class="headerlink" title="DCL - 数据控制语言"></a>DCL - 数据控制语言</h3><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><ul>
<li><p>查询用户：<br><code>SELECT * FROM mysql.user;</code></p>
</li>
<li><p>创建用户:<br><code>CREATE USER &#39;用户名&#39;@&#39;主机名&#39; IDENTIFIED BY &#39;密码&#39;;</code></p>
</li>
<li><p>修改用户密码：<br><code>ALTER USER &#39;用户名&#39;@&#39;主机名&#39; IDENTIFIED WITH mysql_native_password BY &#39;新密码&#39;;</code></p>
</li>
<li><p>删除用户：<br><code>DROP USER &#39;用户名&#39;@&#39;主机名&#39;;</code></p>
</li>
</ul>
<p>注：</p>
<ul>
<li>在MySQL中需要通过<code>用户名@主机名</code>的方式，来唯一标识一个用户</li>
<li>主机名可以使用 % 通配</li>
</ul>
<p>例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建用户test，只能在当前主机localhost访问</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><span class="hljs-comment">-- 创建用户test，能在任意主机访问</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;test&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h4><p>常用权限：</p>
<table>
<thead>
<tr>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ALL, ALL PRIVILEGES</td>
<td>所有权限</td>
</tr>
<tr>
<td>SELECT</td>
<td>查询数据</td>
</tr>
<tr>
<td>INSERT</td>
<td>插入数据</td>
</tr>
<tr>
<td>UPDATE</td>
<td>修改数据</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除数据</td>
</tr>
<tr>
<td>ALTER</td>
<td>修改表</td>
</tr>
<tr>
<td>DROP</td>
<td>删除数据库&#x2F;表&#x2F;视图</td>
</tr>
<tr>
<td>CREATE</td>
<td>创建数据库&#x2F;表</td>
</tr>
</tbody></table>
<ul>
<li><p>查询权限：<br><code>SHOW GRANTS FOR &#39;用户名&#39;@&#39;主机名&#39;;</code></p>
</li>
<li><p>授予权限：<br><code>GRANT 权限列表 ON 数据库名.表名 TO &#39;用户名&#39;@&#39;主机名&#39;;</code></p>
</li>
<li><p>撤销权限：<br><code>REVOKE 权限列表 ON 数据库名.表名 FROM &#39;用户名&#39;@&#39;主机名&#39;;</code></p>
</li>
</ul>
<p>注：</p>
<ul>
<li>多个权限用逗号分隔</li>
<li>授权时，数据库名和表名可以用 * 进行通配，代表所有</li>
</ul>
<p>更多权限请看<a href="#%E6%9D%83%E9%99%90%E4%B8%80%E8%A7%88%E8%A1%A8" title="权限一览表">权限一览表</a></p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数是指一段可以直接被另外一段程序调用的程序或代码，主要分字符串函数、数值函数、日期函数、流程函数四类。</p>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>常用函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CONCAT(s1, s2, …, sn)</td>
<td>字符串拼接，将s1, s2, …, sn拼接成一个字符串</td>
</tr>
<tr>
<td>LOWER(str)</td>
<td>将字符串全部转为小写</td>
</tr>
<tr>
<td>UPPER(str)</td>
<td>将字符串全部转为大写</td>
</tr>
<tr>
<td>LPAD(str, n, pad)</td>
<td>左填充，用字符串pad对str的左边进行填充，达到n个字符串长度</td>
</tr>
<tr>
<td>RPAD(str, n, pad)</td>
<td>右填充，用字符串pad对str的右边进行填充，达到n个字符串长度</td>
</tr>
<tr>
<td>TRIM(str)</td>
<td>去掉字符串头部和尾部的空格</td>
</tr>
<tr>
<td>SUBSTRING(str, start, len)</td>
<td>返回从字符串str从start位置起的len个长度的字符串</td>
</tr>
</tbody></table>
<p>使用示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 拼接</span><br><span class="hljs-keyword">SELECT</span> CONCAT(<span class="hljs-string">&#x27;Hello&#x27;</span>, <span class="hljs-string">&#x27;World&#x27;</span>);<br><span class="hljs-comment">-- 小写</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">LOWER</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br><span class="hljs-comment">-- 大写</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">UPPER</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br><span class="hljs-comment">-- 左填充</span><br><span class="hljs-keyword">SELECT</span> LPAD(<span class="hljs-string">&#x27;01&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br><span class="hljs-comment">-- 右填充</span><br><span class="hljs-keyword">SELECT</span> RPAD(<span class="hljs-string">&#x27;01&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br><span class="hljs-comment">-- 去除空格</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">TRIM</span>(<span class="hljs-string">&#x27; Hello World &#x27;</span>);<br><span class="hljs-comment">-- 切片（起始索引为1）</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-string">&#x27;Hello World&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>);<br></code></pre></td></tr></table></figure>

<h3 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h3><p>常用函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CEIL(x)</td>
<td>向上取整</td>
</tr>
<tr>
<td>FLOOR(x)</td>
<td>向下取整</td>
</tr>
<tr>
<td>MOD(x, y)</td>
<td>返回x&#x2F;y的模</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回0~1内的随机数</td>
</tr>
<tr>
<td>ROUND(x, y)</td>
<td>求参数x的四舍五入值，保留y位小数</td>
</tr>
</tbody></table>
<p>使用示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 向上取整</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.1</span>);<br><span class="hljs-comment">-- 向下取整</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">floor</span>(<span class="hljs-number">1.9</span>);<br><span class="hljs-comment">-- 取模</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">mod</span>(<span class="hljs-number">7</span>, <span class="hljs-number">4</span>);<br><span class="hljs-comment">-- rand</span><br><span class="hljs-keyword">select</span> rand();<br><span class="hljs-comment">-- round</span><br><span class="hljs-keyword">select</span> round(<span class="hljs-number">2.344</span>, <span class="hljs-number">2</span>);<br><br><span class="hljs-comment">-- 生成6位随机验证码</span><br><span class="hljs-keyword">select</span> lpad(round(rand() <span class="hljs-operator">*</span> <span class="hljs-number">1000000</span>, <span class="hljs-number">0</span>), <span class="hljs-number">6</span>, <span class="hljs-string">&#x27;0);</span><br></code></pre></td></tr></table></figure>

<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>常用函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CURDATE()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CURTIME()</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>NOW()</td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td>YEAR(date)</td>
<td>获取指定date的年份</td>
</tr>
<tr>
<td>MONTH(date)</td>
<td>获取指定date的月份</td>
</tr>
<tr>
<td>DAY(date)</td>
<td>获取指定date的日期</td>
</tr>
<tr>
<td>DATE_ADD(date, INTERVAL expr type)</td>
<td>返回一个日期&#x2F;时间值加上一个时间间隔expr后的时间值</td>
</tr>
<tr>
<td>DATEDIFF(date1, date2)</td>
<td>返回起始时间date1和结束时间date2之间的天数</td>
</tr>
</tbody></table>
<p>使用示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- DATE_ADD</span><br><span class="hljs-keyword">SELECT</span> DATE_ADD(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">70</span> <span class="hljs-keyword">YEAR</span>);<br><span class="hljs-comment">-- 获取日期差</span><br><span class="hljs-keyword">select</span> datediff(<span class="hljs-string">&#x27;2022-10-01&#x27;</span>, <span class="hljs-string">&#x27;2022-12-01&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h3 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h3><p>常用函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>IF(value, t, f)</td>
<td>如果value为true，则返回t，否则返回f</td>
</tr>
<tr>
<td>IFNULL(value1, value2)</td>
<td>如果value1不为空，返回value1，否则返回value2</td>
</tr>
<tr>
<td>CASE WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END</td>
<td>如果val1为true，返回res1，… 否则返回default默认值</td>
</tr>
<tr>
<td>CASE [ expr ] WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END</td>
<td>如果expr的值等于val1，返回res1，… 否则返回default默认值</td>
</tr>
</tbody></table>
<p>使用示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- if</span><br><span class="hljs-keyword">select</span> if(<span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;Ok&#x27;</span>, <span class="hljs-string">&#x27;Error&#x27;</span>);<br><span class="hljs-comment">-- ifnull</span><br><span class="hljs-keyword">select</span> ifnull(<span class="hljs-string">&#x27;Ok&#x27;</span>, <span class="hljs-string">&#x27;Default&#x27;</span>);<br><span class="hljs-keyword">select</span> ifnull(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Default&#x27;</span>);<br><span class="hljs-keyword">select</span> ifnull(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;Default&#x27;</span>);<br><span class="hljs-comment">-- case when then else end</span><br><span class="hljs-keyword">select</span> <br>    name, &#123; <span class="hljs-keyword">case</span> wordaddress <span class="hljs-keyword">when</span> <span class="hljs-string">&#x27;北京&#x27;</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;一线城市&#x27;</span> <span class="hljs-keyword">when</span> <span class="hljs-string">&#x27;上海&#x27;</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;一线城市&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;二线城市&#x27;</span> <span class="hljs-keyword">end</span> &#125; <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;工作地址&#x27;</span><br><span class="hljs-keyword">from</span> <br>    emp;<br></code></pre></td></tr></table></figure>


<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>约束是用来作用于表中字段上的规则，用于限制存储在表中的数据。目的是为了保证数据库中的数据的正确性、有效性和完整性</p>
<p>分类：</p>
<table>
<thead>
<tr>
<th>约束</th>
<th>描述</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>非空约束</td>
<td>限制该字段的数据不能为null</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>唯一约束</td>
<td>保证该字段的所有数据都是唯一、不重复的</td>
<td>UNIQUE</td>
</tr>
<tr>
<td>主键约束</td>
<td>主键是一行数据的唯一标识，要求非空且唯一</td>
<td>PRIMARY KEY</td>
</tr>
<tr>
<td>默认约束</td>
<td>保存数据时，如果未指定该字段的值，则采用默认值</td>
<td>DEFAULT</td>
</tr>
<tr>
<td>检查约束（8.0.16版本后）</td>
<td>保证字段值满足某一个条件</td>
<td>CHECK</td>
</tr>
<tr>
<td>外键约束</td>
<td>让两张图的数据之间建立连接，保证数据的一致性和完整性</td>
<td>FOREIGN KEY</td>
</tr>
</tbody></table>
<p>示例:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tb_user(<br>  id <span class="hljs-type">int</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">&#x27;ID唯一标识&#x27;</span>,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">&#x27;姓名&#x27;</span> ,<br>  age <span class="hljs-type">int</span> <span class="hljs-keyword">check</span>(age <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-operator">&amp;&amp;</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">120</span>) COMMENT <span class="hljs-string">&#x27;年龄&#x27;</span> ,<br>  status <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;1&#x27;</span> COMMENT <span class="hljs-string">&#x27;状态&#x27;</span>,<br>  gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) COMMENT <span class="hljs-string">&#x27;性别&#x27;</span><br>);<br></code></pre></td></tr></table></figure>

<h3 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h3><p>让两张表的数据之间建立连接，从而保证数据的一致性和完整性。</p>
<ul>
<li><p>添加外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建表时设置外键</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名(<br>  字段名 字段类型,<br>  ...<br>  [<span class="hljs-keyword">CONSTRAINT</span>] [外键名称] <span class="hljs-keyword">FOREIGN</span> KEY(外键字段名) <span class="hljs-keyword">REFERENCES</span> 主表(主表列名)<br>);<br><br><span class="hljs-comment">-- 对已有的表添加外键</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> 外键名称 <span class="hljs-keyword">FOREIGN</span> KEY (外键字段名) <span class="hljs-keyword">REFERENCES</span> 主表(主表列名);<br><span class="hljs-comment">-- 示例</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> emp <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> fk_emp_dept_id <span class="hljs-keyword">foreign</span> key(dept_id) <span class="hljs-keyword">references</span> dept(id);  <br></code></pre></td></tr></table></figure>
</li>
<li><p>删除外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> KEY 外键名;<br><span class="hljs-comment">-- 示例</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> emp <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign</span> key fk_emp_dept_id;<br></code></pre></td></tr></table></figure>
</li>
<li><p>删除&#x2F;更新行为<br>语法：<br><code>ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段) REFERENCES 主表名(主表字段名) ON UPDATE 行为 ON DELETE 行为;</code></p>
<p>其中，行为包括以下5种：</p>
<table>
<thead>
<tr>
<th>行为</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>NO ACTION</td>
<td>当在父表中删除&#x2F;更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除&#x2F;更新（与RESTRICT一致）</td>
</tr>
<tr>
<td>RESTRICT</td>
<td>当在父表中删除&#x2F;更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除&#x2F;更新（与NO ACTION一致）</td>
</tr>
<tr>
<td>CASCADE</td>
<td>当在父表中删除&#x2F;更新对应记录时，首先检查该记录是否有对应外键，如果有则也删除&#x2F;更新外键在子表中的记录</td>
</tr>
<tr>
<td>SET NULL</td>
<td>当在父表中删除&#x2F;更新对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null（要求该外键允许为null）</td>
</tr>
<tr>
<td>SET DEFAULT</td>
<td>父表有变更时，子表将外键设为一个默认值（Innodb不支持）</td>
</tr>
</tbody></table>
<p>默认值是 <strong>No Action</strong></p>
</li>
</ul>
<h2 id="多表"><a href="#多表" class="headerlink" title="多表"></a>多表</h2><h3 id="多表关系"><a href="#多表关系" class="headerlink" title="多表关系"></a>多表关系</h3><ul>
<li>一对多<ul>
<li>例如：一个部门对应多个员工</li>
<li>实现：在多的一方建立外键，指向一的一方的主键</li>
</ul>
</li>
<li>多对多<ul>
<li>例如：一个学生可以选多门课程，一门课程也可以被多个学生选修  </li>
<li>实现：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</li>
</ul>
</li>
<li>一对一<ul>
<li>例如：一个用户仅对应一个用户详情。常用于单表拆分，以提升操作效率</li>
<li>实现：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（UNIQUE）</li>
</ul>
</li>
</ul>
<h3 id="合并查询"><a href="#合并查询" class="headerlink" title="合并查询"></a>合并查询</h3><blockquote>
<p>笛卡尔积：两个集合A集合和B集合的所有组合情况。在多表查询时，需要消除无效的笛卡尔积<br><code>select * from employee, dept where employee.dept = dept.id;</code></p>
</blockquote>
<h3 id="内连接查询"><a href="#内连接查询" class="headerlink" title="内连接查询"></a>内连接查询</h3><ul>
<li>内连接查询的是两张表交集的部分</li>
<li>隐式内连接：<br><code>SELECT 字段列表 FROM 表1, 表2 WHERE 条件 ...;</code>   </li>
<li>显式内连接：<br><code>SELECT 字段列表 FROM 表1 [ INNER ] JOIN 表2 ON 连接条件 ...;</code>  </li>
<li>通常显式性能比隐式高</li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询员工姓名，及关联的部门的名称</span><br><span class="hljs-comment">-- 隐式</span><br><span class="hljs-keyword">select</span> e.name, d.name <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">as</span> e, dept <span class="hljs-keyword">as</span> d <span class="hljs-keyword">where</span> e.dept <span class="hljs-operator">=</span> d.id;<br><span class="hljs-comment">-- 显式</span><br><span class="hljs-keyword">select</span> e.name, d.name <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">as</span> e <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> dept <span class="hljs-keyword">as</span> d <span class="hljs-keyword">on</span> e.dept <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>


<h3 id="外连接查询"><a href="#外连接查询" class="headerlink" title="外连接查询"></a>外连接查询</h3><ul>
<li><p>左外连接：  </p>
<ul>
<li>查询左表所有数据，以及两张表交集部分数据。相当于查询表1的所有数据，并包含表1和表2交集部分的数据<br><code>SELECT 字段列表 FROM 表1 LEFT [ OUTER ] JOIN 表2 ON 条件 ...;</code></li>
</ul>
</li>
<li><p>右外连接：  </p>
<ul>
<li>查询右表所有数据，以及两张表交集部分数据。相当于查询表2的所有数据，并包含表1和表2交集部分的数据。<br><code>SELECT 字段列表 FROM 表1 RIGHT [ OUTER ] JOIN 表2 ON 条件 ...;</code></li>
</ul>
</li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 两条语句效果一样。左外和右外可以互相转换</span><br><span class="hljs-comment">-- 左外 </span><br><span class="hljs-keyword">select</span> d.name, e.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dept d <span class="hljs-keyword">left</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span> emp e <span class="hljs-keyword">on</span> e.dept <span class="hljs-operator">=</span> d.id;<br><span class="hljs-comment">-- 右外</span><br><span class="hljs-keyword">select</span> d.name, e.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee e <span class="hljs-keyword">right</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept <span class="hljs-operator">=</span> d.id;  <br></code></pre></td></tr></table></figure>


<h3 id="自连接查询"><a href="#自连接查询" class="headerlink" title="自连接查询"></a>自连接查询</h3><ul>
<li>当前表与自身的连接查询，必须使用表别名</li>
<li>自连接查询，可以是内连接查询，也可以是外连接查询<br><code>SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件 ...;</code></li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询员工及其所属领导的名字  </span><br><span class="hljs-keyword">select</span> a.name, b.name <span class="hljs-keyword">from</span> employee a, employee b <span class="hljs-keyword">where</span> a.manager <span class="hljs-operator">=</span> b.id;  <br><span class="hljs-comment">-- 没有领导的也查询出来  </span><br><span class="hljs-keyword">select</span> a.name, b.name <span class="hljs-keyword">from</span> employee a <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> employee b <span class="hljs-keyword">on</span> a.manager <span class="hljs-operator">=</span> b.id;  <br></code></pre></td></tr></table></figure>


<h3 id="联合查询-union-union-all"><a href="#联合查询-union-union-all" class="headerlink" title="联合查询 union, union all"></a>联合查询 union, union all</h3><ul>
<li>把多次查询的结果合并，形成一个新的查询结果</li>
<li>联合的多个查询结果的列数、字段类型必须保持一致</li>
<li>union all直接将结果合并，而union会自动去重</li>
<li>联合查询比使用or效率高，不会使索引失效<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表A ...<br><span class="hljs-keyword">UNION</span> [<span class="hljs-keyword">ALL</span>]<br><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表B ...<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><ul>
<li>SQL语句中嵌套SELECT语句，称谓嵌套查询，又称子查询。</li>
<li>子查询外部的语句可以是 INSERT &#x2F; UPDATE &#x2F; DELETE &#x2F; SELECT 的任何一个</li>
</ul>
<ul>
<li>根据子查询结果可以分为：<ul>
<li>标量子查询（子查询结果为单个值）</li>
<li>列子查询（子查询结果为一列）</li>
<li>行子查询（子查询结果为一行）</li>
<li>表子查询（子查询结果为多行多列）</li>
</ul>
</li>
</ul>
<ul>
<li>根据子查询位置可分为：<ul>
<li>WHERE 之后</li>
<li>FROM 之后</li>
<li>SELECT 之后</li>
</ul>
</li>
</ul>
<h4 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h4><ul>
<li>子查询返回的结果是单个值，如数字、字符串、日期等。  </li>
<li>常用操作符：<code>= &lt;&gt; &gt; &gt;= &lt; &lt;=</code></li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询销售部所有员工</span><br><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;销售部&#x27;</span>;<br><span class="hljs-comment">-- 根据销售部部门ID，查询员工信息</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> dept <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br><span class="hljs-comment">-- 合并（子查询）</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> dept <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;销售部&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h4 id="列子查询"><a href="#列子查询" class="headerlink" title="列子查询"></a>列子查询</h4><ul>
<li>返回的结果是一列（可以是多行）。  </li>
<li>常用操作符：  <table>
<thead>
<tr>
<th>操作符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>IN</td>
<td>在指定的集合范围内，多选一</td>
</tr>
<tr>
<td>NOT IN</td>
<td>不在指定的集合范围内</td>
</tr>
<tr>
<td>ANY</td>
<td>子查询返回列表中，有任意一个满足即可</td>
</tr>
<tr>
<td>SOME</td>
<td>与ANY等同，使用SOME的地方都可以使用ANY</td>
</tr>
<tr>
<td>ALL</td>
<td>子查询返回列表的所有值都必须满足</td>
</tr>
</tbody></table>
</li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询比财务部所有人工资都高的员工信息</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">all</span>(<span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> dept <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;财务部&#x27;</span>));<br><span class="hljs-comment">-- 查询比研发部任意一人工资高的员工信息</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">any</span>(<span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> dept <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;研发部&#x27;</span>));<br></code></pre></td></tr></table></figure>

<h4 id="行子查询"><a href="#行子查询" class="headerlink" title="行子查询"></a>行子查询</h4><ul>
<li>返回的结果是一行（可以是多列）</li>
<li>常用操作符：<code>=, &lt;, &gt;, IN, NOT IN</code></li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询与xxx的薪资及直属领导相同的员工信息  </span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> (salary, manager) <span class="hljs-operator">=</span> (<span class="hljs-number">12500</span>, <span class="hljs-number">1</span>);  <br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> (salary, manager) <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> salary, manager <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;xxx&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h4 id="表子查询"><a href="#表子查询" class="headerlink" title="表子查询"></a>表子查询</h4><ul>
<li>返回的结果是多行多列  </li>
<li>常用操作符：IN</li>
</ul>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询与xxx1，xxx2的职位和薪资相同的员工</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> (job, salary) <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> job, salary <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;xxx1&#x27;</span> <span class="hljs-keyword">or</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;xxx2&#x27;</span>);<br><span class="hljs-comment">-- 查询入职日期是2006-01-01之后的员工，及其部门信息</span><br><span class="hljs-keyword">select</span> e.<span class="hljs-operator">*</span>, d.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> entrydate <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2006-01-01&#x27;</span>) <span class="hljs-keyword">as</span> e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> dept <span class="hljs-keyword">as</span> d <span class="hljs-keyword">on</span> e.dept <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>



<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><blockquote>
<p>事务是一组操作的集合，事务会把所有操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。<br>MySQL的事务默认是自动提交的。开启事务后，只有手动提交才会改变数据库中的数据。</p>
</blockquote>
<h3 id="控制事务"><a href="#控制事务" class="headerlink" title="控制事务"></a>控制事务</h3><ul>
<li><p>控制事务方式一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看事务提交方式</span><br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@AUTOCOMMIT</span>;<br><span class="hljs-comment">-- 设置事务提交方式，1为自动提交，0为手动提交，该设置只对当前会话有效</span><br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@AUTOCOMMIT</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">-- 提交事务</span><br><span class="hljs-keyword">COMMIT</span>;<br><span class="hljs-comment">-- 回滚事务</span><br><span class="hljs-keyword">ROLLBACK</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>控制事务方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 开启事务：</span><br><span class="hljs-keyword">START</span> TRANSACTION 或 <span class="hljs-keyword">BEGIN</span>;<br><span class="hljs-comment">-- DML</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> account <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">-</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">+</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李四&#x27;</span>;<br><span class="hljs-comment">-- 提交事务</span><br><span class="hljs-keyword">COMMIT</span>;<br><span class="hljs-comment">-- 或回滚事务</span><br><span class="hljs-keyword">ROLLBACK</span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="四大特性-ACID"><a href="#四大特性-ACID" class="headerlink" title="四大特性 ACID"></a>四大特性 ACID</h3><ul>
<li>原子性(Atomicity)：事务是不可分割的最小操作但愿，要么全部成功，要么全部失败</li>
<li>一致性(Consistency)：事务完成时，必须使所有数据都保持一致状态</li>
<li>隔离性(Isolation)：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行</li>
<li>持久性(Durability)：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的</li>
</ul>
<h3 id="并发问题"><a href="#并发问题" class="headerlink" title="并发问题"></a>并发问题</h3><table>
<thead>
<tr>
<th>问题</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>一个事务读到另一个事务还没提交的数据</td>
</tr>
<tr>
<td>不可重复读</td>
<td>一个事务先后读取同一条记录，但两次读取的数据不同</td>
</tr>
<tr>
<td>幻读</td>
<td>一个事务按照条件查询数据时，没有对应的数据行，但是再插入数据时，又发现这行数据已经存在</td>
</tr>
</tbody></table>
<h3 id="隔离级别："><a href="#隔离级别：" class="headerlink" title="隔离级别："></a>隔离级别：</h3><p>为了解决并发事务所引发的问题，在数据库中引入了事务隔离级别。主要有以下几种：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>Read uncommitted</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Read committed</td>
<td>×</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Repeatable Read(默认)</td>
<td>×</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>Serializable</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
</tbody></table>
<p>√表示在当前隔离级别下该问题会出现。事务隔离级别越高，数据越安全，但是性能越低</p>
<ul>
<li>查看事务隔离级别：<br><code>SELECT @@TRANSACTION_ISOLATION;</code>  </li>
<li>设置事务隔离级别：<br><code>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL &#123;READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE &#125;;</code><br>SESSION 是会话级别，表示只针对当前会话有效。GLOBAL 表示对所有会话有效</li>
</ul>
<hr>
<h1 id="进阶篇"><a href="#进阶篇" class="headerlink" title="进阶篇"></a>进阶篇</h1><h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><h3 id="MySQL体系结构"><a href="#MySQL体系结构" class="headerlink" title="MySQL体系结构"></a>MySQL体系结构</h3><img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MySQL%E6%9E%B6%E6%9E%84%E5%9B%BE.png" srcset="/img/loading.gif" lazyload class="" title="alt MySQL架构图">

<ul>
<li>连接层：<br>最上层是一些客户端和链接服务，包含本地sock 通信和大多数基于客户端&#x2F;服务端工具实现的类似于TCP&#x2F;IP的通信。主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</li>
<li>服务层：<br>第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如 过程、函数等。在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定表的查询的顺序，是否利用索引等，最后生成相应的执行操作。如果是select语句，服务器还会查询内部的缓存，如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。</li>
<li>引擎层：<br>存储引擎层， 存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。数据库中的索引是在存储引擎层实现的。</li>
<li>存储层：<br>数据存储层， 主要是将数据(如: redolog、undolog、数据、索引、二进制日志、错误日志、查询日志、慢查询日志等)存储在文件系统之上，并完成与存储引擎的交互。</li>
</ul>
<blockquote>
<p>MySQL插件式的存储引擎架构，将查询处理和其它的系统任务以及数据的存储提取分离。<br>这种架构可以根据业务的需求和实际需要选择合适的存储引擎，可以在多种不同场景中应用并发挥良好作用。</p>
</blockquote>
<h3 id="MySQL三大存储引擎"><a href="#MySQL三大存储引擎" class="headerlink" title="MySQL三大存储引擎"></a>MySQL三大存储引擎</h3><blockquote>
<p>存储引擎就是存储数据、建立索引、更新&#x2F;查询数据等技术的实现方式。<br>存储引擎是基于表而不是基于库的，所以存储引擎也被称为表引擎。</p>
</blockquote>
<p>存储引擎相关语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询建表语句</span><br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> account;<br><span class="hljs-comment">-- 建表时指定存储引擎</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名(<br>	...<br>) ENGINE<span class="hljs-operator">=</span>INNODB;<br><span class="hljs-comment">-- 查看当前数据库支持的存储引擎</span><br><span class="hljs-keyword">show</span> engines;<br></code></pre></td></tr></table></figure>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MySQL%E5%BC%95%E6%93%8E%E5%88%97%E8%A1%A8.png" srcset="/img/loading.gif" lazyload class="" title="alt MySQL引擎列表">


<h4 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h4><blockquote>
<p>InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在MySQL 5.5之后，InnoDB是默认的MySQL引擎。  </p>
</blockquote>
<p>特点:</p>
<ul>
<li>DML 操作遵循 ACID 模型，支持<strong>事务</strong></li>
<li><strong>行级锁</strong>，提高并发访问性能</li>
<li>支持<strong>外键</strong>约束，保证数据的完整性和正确性</li>
</ul>
<p>文件：</p>
<ul>
<li>xxx.ibd: xxx代表表名，InnoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（早期是frm、新版是sdi）、数据和索引。</li>
<li>innodb_file_per_table 参数决定多张表共享一个表空间还是每张表对应一个表空间<br><code>show variables like &#39;innodb_file_per_table&#39;;</code><br>从idb文件提取表结构数据的cmd命令：<br><code>ibd2sdi xxx.ibd</code></li>
</ul>
<p>InnoDB 逻辑存储结构：  </p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload class="" title="InnoDB逻辑存储结构">

<ul>
<li><strong>表空间 - Tablespace</strong><br>InnoDB 存储引擎逻辑结构的最高层，ibd文件其实就是表空间文件，在表空间中可以包含多个Segment段。</li>
<li><strong>段 - Segment</strong><br>表空间是由各个段组成的， 常见的段有数据段、索引段、回滚段等。InnoDB中对于段的管理，都是引擎自身完成，不需要人为对其控制，一个段中包含多个Extent区。</li>
<li><strong>区 - Extent</strong><br>区是表空间的单元结构，每个区的大小为1M。一个区包含多个Page页，InnoDB的页默认大小为16K，即一个区中有64个连续的页。</li>
<li><strong>页 - Page</strong><br>页是组成区的最小单元，页也是InnoDB磁盘管理的最小单元。为了保证页的连续性，InnoDB存储引擎每次从磁盘申请 4-5 个区。</li>
<li><strong>行 - Row</strong><br>InnoDB 是面向行的，即数据是按行进行存放的。每一行除了表定义的字段外，还包含两个隐藏字段 Trx id 和 Roll pointer。</li>
</ul>
<h4 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h4><blockquote>
<p>MyISAM 是 MySQL 早期的默认存储引擎。</p>
</blockquote>
<p>特点：</p>
<ul>
<li>不支持事务，不支持外键</li>
<li>支持表锁，不支持行锁</li>
<li>访问速度快</li>
</ul>
<p>文件：</p>
<ul>
<li>xxx.sdi: 存储表结构信息</li>
<li>xxx.MYD: 存储数据</li>
<li>xxx.MYI: 存储索引</li>
</ul>
<h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4><blockquote>
<p>Memory 引擎的表数据存储在内存中，受硬件、断电等问题的影响，因此只能将这些表作为临时表或缓存使用。缓存场景更多使用Redis。</p>
</blockquote>
<p>特点：</p>
<ul>
<li>存放在内存中，速度快</li>
<li>默认hash索引</li>
</ul>
<p>文件：</p>
<ul>
<li>xxx.sdi: 存储表结构信息</li>
</ul>
<h3 id="存储引擎特点"><a href="#存储引擎特点" class="headerlink" title="存储引擎特点"></a>存储引擎特点</h3><table>
<thead>
<tr>
<th align="center">特点</th>
<th align="center">InnoDB</th>
<th align="center">MyISAM</th>
<th align="center">Memory</th>
</tr>
</thead>
<tbody><tr>
<td align="center">存储限制</td>
<td align="center">64TB</td>
<td align="center">有</td>
<td align="center">有</td>
</tr>
<tr>
<td align="center">事务安全</td>
<td align="center">支持</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">锁机制</td>
<td align="center">行锁</td>
<td align="center">表锁</td>
<td align="center">表锁</td>
</tr>
<tr>
<td align="center">B+tree索引</td>
<td align="center">支持</td>
<td align="center">支持</td>
<td align="center">支持</td>
</tr>
<tr>
<td align="center">Hash索引</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">支持</td>
</tr>
<tr>
<td align="center">全文索引</td>
<td align="center">支持（5.6版本之后）</td>
<td align="center">支持</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">空间使用</td>
<td align="center">高</td>
<td align="center">低</td>
<td align="center">N&#x2F;A</td>
</tr>
<tr>
<td align="center">内存使用</td>
<td align="center">高</td>
<td align="center">低</td>
<td align="center">中等</td>
</tr>
<tr>
<td align="center">批量插入速度</td>
<td align="center">低</td>
<td align="center">高</td>
<td align="center">高</td>
</tr>
<tr>
<td align="center">支持外键</td>
<td align="center">支持</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
</tbody></table>
<p>总结InnoDB和MyISAM的区别：</p>
<ul>
<li>InnoDB支持事务, 而MyISAM不支持</li>
<li>InnoDB支持行锁和表锁, 而MyISAM仅支持表锁, 不支持行锁</li>
<li>InnoDB支持外键, 而MyISAM不支持</li>
</ul>
<h3 id="存储引擎选择"><a href="#存储引擎选择" class="headerlink" title="存储引擎选择"></a>存储引擎选择</h3><ul>
<li>InnoDB<br>如果应用对事物的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，则 InnoDB 是比较合适的选择</li>
<li>MyISAM<br>如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不高，那这个存储引擎是非常合适的</li>
<li>Memory<br>将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。Memory 的缺陷是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性</li>
</ul>
<blockquote>
<p>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p>
</blockquote>
<h2 id="索引-⭐⭐⭐"><a href="#索引-⭐⭐⭐" class="headerlink" title="索引 ⭐⭐⭐"></a>索引 ⭐⭐⭐</h2><h3 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h3><blockquote>
<p>索引（index）是帮助 MySQL 高效获取数据的有序数据结构。<br>除了实际存储的数据，DBS 还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，可以借此实现高效的查找算法。<br>这种数据结构就是索引。</p>
</blockquote>
<p>优点：</p>
<ul>
<li>提高数据检索效率，降低数据库的IO成本  </li>
<li>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗</li>
</ul>
<p>缺点：</p>
<ul>
<li>索引列需要占用额外空间</li>
<li>索引大大提高了查询效率，但降低了更新的速度，如INSERT、UPDATE、DELETE</li>
</ul>
<h3 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h3><p>MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构，主要包含以下几种：</p>
<table>
<thead>
<tr>
<th>索引结构</th>
<th>描述</th>
<th align="center">InnoDB</th>
<th align="center">MyISAM</th>
<th align="center">Memory</th>
</tr>
</thead>
<tbody><tr>
<td>B+Tree</td>
<td>最常见的索引类型，大部分引擎都支持B+树索引</td>
<td align="center">支持</td>
<td align="center">支持</td>
<td align="center">支持</td>
</tr>
<tr>
<td>Hash</td>
<td>底层数据结构是用哈希表实现，只有精确匹配索引列的查询才有效，不支持范围查询</td>
<td align="center">不支持</td>
<td align="center">不支持</td>
<td align="center">支持</td>
</tr>
<tr>
<td>R-Tree(空间索引)</td>
<td>空间索引是 MyISAM 引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少</td>
<td align="center">不支持</td>
<td align="center">支持</td>
<td align="center">不支持</td>
</tr>
<tr>
<td>Full-Text(全文索引)</td>
<td>是一种通过建立倒排索引，快速匹配文档的方式，类似于 Lucene, Solr, ES</td>
<td align="center">5.6版本后支持</td>
<td align="center">支持</td>
<td align="center">不支持</td>
</tr>
</tbody></table>
<p>注：如果没有特别指明，一般指<strong>B+树</strong>结构组织的索引。</p>
<h4 id="普通索引结构"><a href="#普通索引结构" class="headerlink" title="普通索引结构"></a>普通索引结构</h4><ul>
<li><p>二叉树：</p>
<ul>
<li>根据值构造二叉排序树，树的形状依赖于插入顺序</li>
<li>顺序插入时会形成一个链表，大大降低查询性能</li>
<li>大数据量情况下，层级较深，检索速度慢</li>
</ul>
</li>
<li><p>红黑树：</p>
<ul>
<li>自平衡二叉树</li>
<li>仍然存在大数据量情况下，层级较深，检索速度慢的问题</li>
</ul>
</li>
</ul>
<h4 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h4><ul>
<li>B树是一种<strong>多叉平衡查找树</strong>，相对于二叉树，B树每个节点可以有多个分支，即多叉。</li>
<li>如果一棵B树的最大度数为n (n阶)，则这棵B树每个节点最多存储 n-1 个key，以及 n 个指针</li>
<li>一旦节点存储的key数量到达n，就会裂变，中间元素向上分裂形成新的节点</li>
<li>B树中，非叶子节点和叶子节点都会存放实际数据</li>
<li>树的度数：一个节点的子节点个数，实现上即指针个数</li>
</ul>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/B-Tree.png" srcset="/img/loading.gif" lazyload class="" title="alt B-Tree">


<h4 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h4><ul>
<li>B+Tree是B-Tree的变种</li>
<li>非叶子节点仅作为索引，不存储数据</li>
<li>叶子节点存储实际数据，且所有叶子节点形成一个单向链表</li>
</ul>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/B+Tree.png" srcset="/img/loading.gif" lazyload class="" title="alt B+Tree">

<ul>
<li>MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加一个指向相邻叶子节点的指针，所有叶子节点形成双向循环链表</li>
<li>这种B+Tree提高了区间访问的性能，利于排序</li>
</ul>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MySQL_B+Tree.png" srcset="/img/loading.gif" lazyload class="" title="alt MySQL_B+Tree">


<h4 id="Hash索引"><a href="#Hash索引" class="headerlink" title="Hash索引"></a>Hash索引</h4><ul>
<li>哈希索引就是采用一定的hash算法，将键值换算成新的Hash值，映射到对应的槽位上，然后存储在Hash表中。</li>
<li>如果两个(或多个)键值，映射到一个相同的槽位上，他们就产生了Hash冲突（也称为Hash碰撞），可以通过链表来解决。</li>
<li>特点：<ul>
<li>Hash索引只能用于对等比较<code>(=，in)</code>，不支持范围查询<code>(between，&gt;，&lt; ，...)</code></li>
<li>无法利用索引完成排序操作</li>
<li>查询效率高，通常 (不存在hash冲突的情况下) 只需要一次检索，效率通常高于B+Tree索引</li>
</ul>
</li>
<li>存储引擎支持：<ul>
<li>Memory存储引擎支持Hash索引</li>
<li>InnoDB具有自适应Hash功能，其索引根据B+Tree索引在指定条件下自动构建</li>
</ul>
</li>
</ul>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/Hash%E7%B4%A2%E5%BC%95.png" srcset="/img/loading.gif" lazyload class="" title="alt Hash索引">


<blockquote>
<p>综上，InnoDB选择B+Tree索引结构的原因有：</p>
<ul>
<li>相对于二叉树，层级更少，搜索效率高</li>
<li>相对于 B-Tree，无论是叶子节点还是非叶子节点，都会保存数据，导致一页中存储的键值减少，指针也跟着减少，需要保存大量数据时，只能增加树的高度，导致性能降低</li>
<li>相对于 Hash 索引，B+Tree 支持范围匹配及排序操作</li>
</ul>
</blockquote>
<h3 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h3><p>MySQL中，索引的具体类型主要分为以下几类：</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>含义</th>
<th>特点</th>
<th align="center">关键字</th>
</tr>
</thead>
<tbody><tr>
<td>主键索引</td>
<td>针对于表中主键创建的索引</td>
<td>默认自动创建，只能有一个</td>
<td align="center">PRIMARY</td>
</tr>
<tr>
<td>唯一索引</td>
<td>避免同一个表中某数据列中的值重复</td>
<td>可以有多个</td>
<td align="center">UNIQUE</td>
</tr>
<tr>
<td>常规索引</td>
<td>快速定位特定数据</td>
<td>可以有多个</td>
<td align="center"></td>
</tr>
<tr>
<td>全文索引</td>
<td>全文索引查找的是文本中的关键词，而不是比较索引中的值</td>
<td>可以有多个</td>
<td align="center">FULLTEXT</td>
</tr>
</tbody></table>
<p>InnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种：</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>含义</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>聚集索引 (Clustered Index)</td>
<td>将数据存储与索引放一块，索引结构的叶子节点保存了行数据</td>
<td>必须有，而且只有一个</td>
</tr>
<tr>
<td>二级索引 (Secondary Index)</td>
<td>将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</td>
<td>可以存在多个</td>
</tr>
</tbody></table>
<p><strong>聚集索引 选取规则：</strong></p>
<ul>
<li>如果存在主键，主键索引就是聚集索引</li>
<li>如果不存在主键，将使用第一个唯一(UNIQUE)索引作为聚集索引</li>
<li>如果表没有主键或没有合适的唯一索引，则 InnoDB 会自动生成一个 rowid 作为隐藏的聚集索引</li>
</ul>
<br>

<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95.png" srcset="/img/loading.gif" lazyload class="" title="alt 聚集索引和二级索引">
<center>聚集索引和二级索引的具体结构</center>

<ul>
<li>聚集索引的叶子节点下挂的是这一行的数据</li>
<li>二级索引的叶子节点下挂的是该字段值对应的主键值</li>
</ul>
<br>

<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B.png" srcset="/img/loading.gif" lazyload class="" title="alt 二级索引查找过程">
<center>具体查找过程</center>

<p><strong>回表查询过程 (二级索引 -&gt; 主键值 -&gt; 聚集索引)：</strong></p>
<ul>
<li>由于是根据name字段进行查询，所以先根据name&#x3D;’Arm’到name字段的二级索引中进行匹配查找。但是在二级索引中只能查找到 Arm 对应的主键值 10。</li>
<li>由于查询需要返回的数据是*，所以此时还需要根据主键值10，到聚集索引中查找10对应的完整记录，最终找到10对应的行row并返回。</li>
</ul>
<h3 id="索引语法"><a href="#索引语法" class="headerlink" title="索引语法"></a>索引语法</h3><ul>
<li><p>创建索引：<br><code>CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (index_col_name, ...);</code><br>如果 CREATE 后面不加索引类型参数，则创建的是常规索引  </p>
</li>
<li><p>查看索引：<br><code>SHOW INDEX FROM table_name;</code>  </p>
</li>
<li><p>删除索引：<br><code>DROP INDEX index_name ON table_name;</code></p>
</li>
</ul>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- name字段为姓名字段，该字段的值可能会重复，为该字段创建索引</span><br><span class="hljs-keyword">create</span> index idx_user_name <span class="hljs-keyword">on</span> tb_user(name);<br><span class="hljs-comment">-- phone手机号字段的值非空，且唯一，为该字段创建唯一索引</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">unique</span> index idx_user_phone <span class="hljs-keyword">on</span> tb_user (phone);<br><span class="hljs-comment">-- 为profession, age, status创建联合索引</span><br><span class="hljs-keyword">create</span> index idx_user_pro_age_stat <span class="hljs-keyword">on</span> tb_user(profession, age, status);<br><br><span class="hljs-comment">-- 删除索引</span><br><span class="hljs-keyword">drop</span> index idx_user_name <span class="hljs-keyword">on</span> tb_user;<br></code></pre></td></tr></table></figure>


<h3 id="SQL性能分析"><a href="#SQL性能分析" class="headerlink" title="SQL性能分析"></a>SQL性能分析</h3><ul>
<li><p><strong>执行频率</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- session 是查看当前会话</span><br><span class="hljs-comment">-- global  是查询全局数据</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;Com_______&#x27;</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>慢查询日志</strong><br>指定SQL语句执行时间超过某个时间，就被视为慢查询，并记录下日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 开启MySQL慢日志查询开关</span><br>slow_query_log<span class="hljs-operator">=</span><span class="hljs-number">1</span><br><span class="hljs-comment">-- 设置超时时间为2秒</span><br>long_query_time<span class="hljs-operator">=</span><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>profile</strong><br>在SQL优化时分析具体的时间开销</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- have_profiling参数查看当前MySQL是否支持profile操作</span><br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@have</span>_profiling;<br><span class="hljs-comment">-- 开启profiling</span><br><span class="hljs-keyword">SET</span> profiling <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- 查看每一条SQL的耗时基本情况</span><br><span class="hljs-keyword">show</span> profiles;<br><span class="hljs-comment">-- 查看指定query_id的SQL语句各个阶段的耗时情况</span><br><span class="hljs-keyword">show</span> profile <span class="hljs-keyword">for</span> query query_id;<br><span class="hljs-comment">-- 查看指定query_id的SQL语句的CPU使用情况</span><br><span class="hljs-keyword">show</span> profile cpu <span class="hljs-keyword">for</span> query query_id;<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>explain</strong><br>EXPLAIN 或者 DESC 命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 直接在select语句之前加上关键字 explain / desc</span><br>EXPLAIN <span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件;<br></code></pre></td></tr></table></figure>

<p>explain执行计划中各个字段的含义：</p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td>select查询的序列号，表示查询中执行select子句或者是操作表的顺序(id相同，执行顺序从上到下；id不同，值越大，越先执行)。</td>
</tr>
<tr>
<td align="left">select_type</td>
<td>表示 SELECT 的类型，常见的取值有 SIMPLE（简单表，即不使用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION 中的第二个或者后面的查询语句）、SUBQUERY（SELECT&#x2F;WHERE之后包含了子查询）等</td>
</tr>
<tr>
<td align="left">type</td>
<td>表示连接类型，性能由好到差的连接类型为NULL、system、const、eq_ref、ref、range、 index、all</td>
</tr>
<tr>
<td align="left">possible_key</td>
<td>显示可能应用在这张表上的索引，一个或多个</td>
</tr>
<tr>
<td align="left">key</td>
<td>实际使用的索引，如果为NULL，则没有使用索引</td>
</tr>
<tr>
<td align="left">ken_len</td>
<td>表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好</td>
</tr>
<tr>
<td align="left">rows</td>
<td>MySQL认为必须要执行查询的行数。在InnoDB引擎的表中，是一个估计值，可能并不总是准确的</td>
</tr>
<tr>
<td align="left">filtered</td>
<td>表示返回结果的行数占需读取行数的百分比，filtered的值越大越好</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="索引使用"><a href="#索引使用" class="headerlink" title="索引使用"></a>索引使用</h3><h4 id="单列索引与联合索引"><a href="#单列索引与联合索引" class="headerlink" title="单列索引与联合索引"></a>单列索引与联合索引</h4><ul>
<li>单列索引：即一个索引只包含单个列</li>
<li>联合索引：即一个索引关联多个列</li>
</ul>
<blockquote>
<p>在业务场景中，如果存在多个查询条件，考虑针对查询字段建立索引时，建议建立联合索引，而非单列索引。<br>多条件联合查询时，MySQL优化器会评估哪个字段的索引效率更高，选择该索引完成本次查询。</p>
</blockquote>
<p>联合索引结构图：</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload class="" title="alt 联合索引结构">


<h4 id="最左前缀法则"><a href="#最左前缀法则" class="headerlink" title="最左前缀法则"></a>最左前缀法则</h4><ul>
<li>联合索引遵守最左前缀法则，即查询从索引的最左列开始，并且不跳过索引中的列。  </li>
<li>如果跳跃某一列，后面字段的排序就无法保证，因此后面字段的索引将失效。</li>
<li>最左前缀法则在select的时候，和字段书写的位置没有关系。</li>
<li>联合索引中，如果出现范围查询（&lt;, &gt;），其后的列索引将失效。可以用 &gt;&#x3D; 或者 &lt;&#x3D; 来规避索引失效问题。</li>
</ul>
<p>例如，一个联合索引的顺序是 profession -&gt; age -&gt; status (创建索引时定义的顺序), 只要select没有选中某一列，那么其后的索引都将失效，即查询时不会使用该列之后的字段索引。</p>
<h4 id="索引失效情况"><a href="#索引失效情况" class="headerlink" title="索引失效情况"></a>索引失效情况</h4><ol>
<li><p>在索引列上进行运算操作，索引将失效<br>如：<code>explain select * from tb_user where substring(phone, 10, 2) = &#39;15&#39;;</code></p>
</li>
<li><p>字符串类型不加引号，索引将失效<br>如：<code>explain select * from tb_user where phone = 17799990015;</code> </p>
</li>
<li><p>模糊查询中对头部模糊匹配，索引将失效<br>如：<code>explain select * from tb_user where profession like &#39;%工程&#39;;</code>，<br>对前后都模糊匹配也会失效：<code>explain select * from tb_user where profession like &#39;%工%&#39;;</code><br>仅对尾部模糊匹配不会失效：<code>explain select * from tb_user where profession like &#39;软件%&#39;;</code></p>
</li>
<li><p>用 or 连接的条件，左右两侧字段都有索引时，索引才会生效<br>因为只要有一个没有索引，另一个用不用索引没有意义，仍要进行全表扫描，所以无需用索引。</p>
</li>
<li><p>数据分布的影响<br>如果 MySQL 评估使用索引比全表更慢，则不使用索引。因为索引是用来索引少量数据的，如果通过索引查询返回大批量的数据，则还不如走全表扫描来的快，此时索引就会失效。</p>
</li>
</ol>
<h4 id="SQL-提示"><a href="#SQL-提示" class="headerlink" title="SQL 提示"></a>SQL 提示</h4><p>优化数据库的一个重要手段，在SQL语句中加入一些手动提示，优化MySQL的索引使用策略，以提升性能</p>
<ul>
<li>建议使用索引 - use index<br><code>explain select * from tb_user use index(idx_user_pro) where profession=&quot;软件工程&quot;;</code></li>
<li>忽略索引 - ignore index<br><code>explain select * from tb_user ignore index(idx_user_pro) where profession=&quot;软件工程&quot;;</code></li>
<li>强制使用索引 - force index<br><code>explain select * from tb_user force index(idx_user_pro) where profession=&quot;软件工程&quot;;</code></li>
</ul>
<h4 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h4><blockquote>
<p>应尽量使用覆盖索引，减少 <code>select *</code><br>即需要查询的数据在单个索引结构中能够全部获取到，避免回表查询</p>
</blockquote>
<p>explain 执行计划中 extra 字段含义：</p>
<ul>
<li><code>using index condition</code>：查找使用了索引，但是需要回表查询数据</li>
<li><code>using where; using index;</code>：查找使用了索引，但是需要的数据都在索引列中能找到，不需要回表查询。因此性能更高</li>
</ul>
<p>非覆盖索引查询示意：</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%9D%9E%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E6%9F%A5%E8%AF%A2.png" srcset="/img/loading.gif" lazyload class="" title="alt 非覆盖索引查询">


<h4 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h4><p>当字段类型为字符串（varchar, text等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO，影响查询效率。此时可以只对字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p>
<p><strong>语法：</strong><br><code>create index idx_xxxx on table_name(columnn(n));</code></p>
<p><strong>前缀长度：</strong><br>可以根据索引的选择性来决定。选择性指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高。唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p>
<p>求选择性公式： </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 全长度索引选择性</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> email) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-comment">-- 前缀索引选择性</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> <span class="hljs-built_in">substring</span>(email, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user;<br></code></pre></td></tr></table></figure>

<p><strong>前缀索引查询示意：</strong></p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E6%9F%A5%E8%AF%A2.png" srcset="/img/loading.gif" lazyload class="" title="alt 前缀索引查询">

<ul>
<li>索引具体结构和索引创建时的字段声明顺序有关</li>
<li>前缀索引中有可能碰到相同索引的情况，因此拿到一个叶子节点(lvbu6)获取id后，需要回表查询row是否与where条件一致</li>
<li>回表查询结束后，还要对该叶子节点的后续节点(xiaoy)查询是否符合where条件，不符合则结束查询</li>
</ul>
<h3 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h3><ol>
<li>针对数据量较大，且查询比较频繁的表建立索引</li>
<li>针对常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引</li>
<li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高</li>
<li>如果是字符串类型的字段，字段长度较长，可以针对字段的特点，建立前缀索引</li>
<li>尽量使用联合索引，减少单列索引。查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率</li>
<li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价就越大，会影响增删改的效率</li>
<li>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询</li>
</ol>
<h2 id="SQL-优化"><a href="#SQL-优化" class="headerlink" title="SQL 优化"></a>SQL 优化</h2><h3 id="insert-优化"><a href="#insert-优化" class="headerlink" title="insert 优化"></a>insert 优化</h3><ul>
<li>批量插入数据，一次插入的数据不建议超过1000条，500 - 1000 为宜</li>
<li>手动控制事务</li>
<li>主键顺序插入，性能要高于乱序插入</li>
<li>大批量插入数据，如几百万条记录，使用insert性能较低。建议使用load指令将数据文件加载到数据表中<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 客户端连接服务端时，加上参数 -–local-infile</span><br>mysql –<span class="hljs-operator">-</span><span class="hljs-keyword">local</span><span class="hljs-operator">-</span>infile <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br><span class="hljs-comment">-- 设置全局参数local_infile为1，开启从本地加载文件导入数据的开关</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> local_infile <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">select</span> @<span class="hljs-variable">@local</span>_infile;<br><br><span class="hljs-comment">-- 执行load指令将准备好的数据，加载到表结构中。字段间用逗号分割，行末添加换行</span><br>load data <span class="hljs-keyword">local</span> infile <span class="hljs-string">&#x27;/root/sql.dat&#x27;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> tb_user fields terminated <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;,&#x27;</span> lines terminated <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;\n&#x27;</span> ;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><p>在InnoDB存储引擎中，表数据都是根据主键按序组织存放的，这种存储方式的表称为索引组织表（Index Organized Table - IOT）。</p>
<p>行数据存储在聚集索引的叶子节点上，记录在逻辑结构Page页中，每个页的大小是有限的，因此如果插入的数据行row在该页存储不下，将会存储到下一页中，页与页之间通过指针连接。</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E7%B4%A2%E5%BC%95%E7%BB%84%E7%BB%87%E8%A1%A8.png" srcset="/img/loading.gif" lazyload class="" title="alt 索引组织表">

<p>但是如果主键是乱序插入的话，就会导致需要插入的位置为一页中间的位置，可能需要进行页分裂。</p>
<ul>
<li><p>页分裂：相邻页的空间都写满后，如果需要在中间插入一个新的数据行，必须对页进行分裂操作。</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%88%86%E8%A3%821.png" srcset="/img/loading.gif" lazyload class="" title="alt 页分裂1">
<center> 插入新row </center>

<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%88%86%E8%A3%822.png" srcset="/img/loading.gif" lazyload class="" title="alt 页分裂2">
<center> 页分裂后 </center>
</li>
<li><p>页合并：当删除一行记录时，实际上记录并没有被物理删除，只是被标记为删除，并且它的空间允许被其他记录使用。当页中删除的记录达到 MERGE_THRESHOLD（默认50%，可指定），InnoDB会开始寻找邻近页，看是否可以将多个页合并以优化空间使用。</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%90%88%E5%B9%B61.png" srcset="/img/loading.gif" lazyload class="" title="alt 页合并1">
<center> 删除达到MERGE_THRESHOLD </center>

<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E9%A1%B5%E5%90%88%E5%B9%B62.png" srcset="/img/loading.gif" lazyload class="" title="alt 页合并2">
<center> 页合并后 </center></li>
</ul>
<p><strong>主键设计原则：</strong></p>
<ul>
<li>满足业务需求的情况下，尽量降低主键的长度。二级索引的叶子节点保存的就是主键，所以主键小占用的空间也就会少。</li>
<li>插入数据时，尽量选择顺序插入，尽量使用 AUTO_INCREMENT 自增主键</li>
<li>尽量不要使用 UUID 做主键或者是其他的自然主键，如身份证号，占用空间大。</li>
<li>业务操作时，避免对主键的修改</li>
</ul>
<h3 id="order-by-优化"><a href="#order-by-优化" class="headerlink" title="order by 优化"></a>order by 优化</h3><ul>
<li>Using filesort：通过表的索引或全表扫描，读取满足条件的数据行，然后在排序缓冲区 sort buffer 中完成排序操作。所有不是通过索引直接返回排序结果的排序都叫 FileSort 排序，性能较低。</li>
<li>Using index：通过有序索引顺序扫描直接返回有序数据。借助已经有序的索引，不需要额外排序，因此性能高。</li>
</ul>
<blockquote>
<p>如果order by的字段存在索引，符合索引的排序顺序，且遵守最左前缀法则，则会直接using index，否则using filesort。</p>
</blockquote>
<p><strong>准则：</strong></p>
<ul>
<li>根据排序字段建立合适的索引，多字段排序时，也遵循最左前缀法则</li>
<li>尽量使用覆盖索引</li>
<li>多字段排序需要注意联合索引在创建时的规则（ASC&#x2F;DESC）</li>
<li>如果不可避免出现filesort，大数据量排序时，可以适当增大排序缓冲区大小 sort_buffer_size（默认256k）</li>
</ul>
<h3 id="group-by-优化"><a href="#group-by-优化" class="headerlink" title="group by 优化"></a>group by 优化</h3><ul>
<li>在分组操作时，可以通过索引来提高效率，尽量规避 using temporary 的分组</li>
<li>分组操作时，索引的使用也满足最左前缀法则</li>
</ul>
<h3 id="limit-优化"><a href="#limit-优化" class="headerlink" title="limit 优化"></a>limit 优化</h3><p>在数据量比较大时，如果进行limit分页查询，在查询时，越往后，分页查询效率越低。如<code>limit 2000000, 10</code>，此时需要 MySQL 排序前2000000条记录，但仅仅返回2000000 - 2000010的记录，其他记录丢弃，查询排序的代价非常大。</p>
<p>优化方案：一般分页查询时，通过创建覆盖索引能够提高性能，可以通过覆盖索引加子查询的形式进行优化</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 此语句耗时很长</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_sku limit <span class="hljs-number">9000000</span>, <span class="hljs-number">10</span>;<br><span class="hljs-comment">-- 通过覆盖索引加快速度，直接通过主键索引进行排序及查询</span><br><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tb_sku <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id limit <span class="hljs-number">9000000</span>, <span class="hljs-number">10</span>;<br><span class="hljs-comment">-- 下面的语句会报错，因为 MySQL 不支持 in 子句里面使用 limit</span><br><span class="hljs-comment">-- select * from tb_sku where id in (select id from tb_sku order by id limit 9000000, 10);</span><br><span class="hljs-comment">-- 通过连表查询即可实现第一句的效果，并且能达到第二句的速度</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_sku <span class="hljs-keyword">as</span> s, (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tb_sku <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id limit <span class="hljs-number">9000000</span>, <span class="hljs-number">10</span>) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">where</span> s.id <span class="hljs-operator">=</span> a.id;<br></code></pre></td></tr></table></figure>


<h3 id="count-优化"><a href="#count-优化" class="headerlink" title="count 优化"></a>count 优化</h3><p>如果数据量很大，执行count操作是非常耗时的。不同存储引擎的 count 实现机制不同：</p>
<ul>
<li>MyISAM 引擎把一个表的总行数存在了磁盘上，因此执行 count(*) 的时候会直接返回这个数，效率很高（不使用带条件的count）</li>
<li>InnoDB 在执行 count(*) 时，需要把数据一行一行地从引擎里面读出来，然后累积计数。</li>
</ul>
<p>优化方案：自己计数，如创建key-value表存储在内存或硬盘，或者用redis  </p>
<p><strong>count的用法：</strong><br>对于一个row，如果count函数的参数对应的字段不是NULL，累计值就加一，最后返回累计值。</p>
<table>
<thead>
<tr>
<th>用法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>count(主键)</td>
<td>InnoDB引擎会遍历整张表，把每行的主键id值都取出来，返回给服务层，服务层拿到主键后，直接按行进行累加（主键自然不可能为null）</td>
</tr>
<tr>
<td>count(字段)</td>
<td>没有not null约束的话，InnoDB引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，服务层判断是否为null，不为null，计数累加；有not null约束的话，InnoDB引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，直接按行进行累加</td>
</tr>
<tr>
<td>count(1)</td>
<td>InnoDB 引擎遍历整张表，但不取值。服务层对于返回的每一层，放一个数字 1 进去，直接按行进行累加</td>
</tr>
<tr>
<td>count(*)</td>
<td>InnoDB 引擎并不会把全部字段取出来，而是专门做了优化，不取值，服务层直接按行进行累加</td>
</tr>
</tbody></table>
<p>由于主键必然非空，因此count(主键) &#x3D; count(*) &#x3D; count(1)，而 count(null) 返回0<br>性能排序：count(字段) &lt; count(主键) &lt; count(1) &lt; count(*)，所以尽量使用 count(*)</p>
<h3 id="update-优化"><a href="#update-优化" class="headerlink" title="update 优化"></a>update 优化</h3><p>执行删、改操作会对数据进行加锁，且行锁的性能高于表锁。InnoDB 的行锁是针对索引加锁，不是针对记录加锁，并且该索引不能失效，否则会从行锁升级为表锁。因此建议尽量使用覆盖索引。</p>
<p>如以下两条语句：<br><code>update student set no = &#39;123&#39; where id = 1;</code> 此SQL由于id有主键索引，所以只会锁这一行；<br><code>update student set no = &#39;123&#39; where name = &#39;test&#39;;</code> 此SQL由于name没有索引，所以会把整张表都锁住进行数据更新。</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图（View）是一种虚拟存在的表。视图中的数据并不实际存储在数据库中，数据来自定义视图的查询中使用的表(称为基表)，并且在使用视图时动态生成。通俗的讲，视图只保存了查询的SQL逻辑，不保存查询结果。所以在创建视图时，主要工作落在创建SQL查询语句上。  </p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul>
<li><p>创建视图<br><code>CREATE [ OR REPLACE ] VIEW 视图名称[(列名列表)] AS SELECT语句 [ WITH [ CASCADED | LOCAL ] CHECK OPTION ]</code><br>如：<code>create or replace view stu_wll as select id, name from student where id &lt;= 10;</code></p>
</li>
<li><p>查看创建视图语句<br><code>SHOW CREATE VIEW 视图名称;</code></p>
</li>
<li><p>查看视图数据<br><code>SELECT * FROM 视图名称;</code></p>
</li>
<li><p>修改视图</p>
<ul>
<li><code>CREATE[OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT 语句[ WITH[ CASCADED | LOCAL ] CHECK OPTION ]</code></li>
<li><code>ALTER VIEW 视图名称 [(列名列表)] AS SELECT语句 [WITH [CASCADED | LOCAL] CHECK OPTION]</code><br>如：<code>alter view stu_v_1 as select id, name from student where id &lt;= 10;</code></li>
</ul>
</li>
<li><p>删除视图<br><code>DROP VIEW [IF EXISTS] 视图名称 [, 视图名称 ... ]</code></p>
</li>
</ul>
<h3 id="检查选项"><a href="#检查选项" class="headerlink" title="检查选项"></a>检查选项</h3><p>MySQL允许一个视图依赖另一个视图，无论是否使用<code>WITH CHECK OPTION</code>，都会向下查询所依赖视图中的规则以保持一致性。<br>如果使用<code>WITH CHECK OPTION</code>创建视图，MySQL会通过视图检查正在更改的每个行，例如插入，更新，删除，以使其符合视图的定义。CASCADED (默认) 和 LOCAL 限定了检查的范围。</p>
<ul>
<li><p>CASCADED - 级联<br>自该视图起，向下所依赖视图的规则都将进行检查。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 比如下面的例子：创建stu_V_l 视图，id是小于等于 20的。  </span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">view</span> stu_V_l <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> id,name <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id <span class="hljs-operator">&lt;=</span><span class="hljs-number">20</span>;<br><span class="hljs-comment">-- 再创建 stu_v_2 视图，20 &gt;= id &gt;=10。  </span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">view</span> stu_v_2 <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> id,name <span class="hljs-keyword">from</span> stu_v_1 <span class="hljs-keyword">where</span> id <span class="hljs-operator">&gt;=</span><span class="hljs-number">10</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">cascaded</span> <span class="hljs-keyword">check</span> option;<br><span class="hljs-comment">-- 再创建 stu_v_3 视图。     </span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">view</span> stu_v_3 <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> id,name <span class="hljs-keyword">from</span> stu_v_2 <span class="hljs-keyword">where</span> id<span class="hljs-operator">&lt;=</span><span class="hljs-number">15</span>; <br><span class="hljs-comment">-- 这条数据能够成功，stu_v_3 没有开检查选项所以不会判断 id 是否小于等于15。但是stu_v_2的check option是级联的，因此会检查 stu_v_2 以及 stu_v_1 的条件。  </span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> stu_v_3 <span class="hljs-keyword">values</span>(<span class="hljs-number">17</span>,<span class="hljs-string">&#x27;Tom&#x27;</span>);<br></code></pre></td></tr></table></figure>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/cascade_cp.png" srcset="/img/loading.gif" lazyload class="" title="alt cascade_cp">
</li>
<li><p>LOCAL - 本地<br>仍会向下查询依赖视图的规则，但具体是否检查看各自视图的定义。</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/local_cp.png" srcset="/img/loading.gif" lazyload class="" title="alt local_cp"></li>
</ul>
<h3 id="更新条件"><a href="#更新条件" class="headerlink" title="更新条件"></a>更新条件</h3><p>要使视图可更新，视图中的行与基表中的行之间必须存在一对一的关系。如果视图包含以下任何一项，则该视图不可更新：</p>
<ul>
<li>聚合函数或窗口函数 (SUM()、MIN()、MAX()、COUNT() 等)</li>
<li>DISTINCT</li>
<li>GROUP BY</li>
<li>HAVING</li>
<li>UNION 或者 UNION ALL</li>
</ul>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul>
<li>简单<br>视图不仅可以简化用户对数据的理解，也可以简化他们的操作。那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的条件。 </li>
<li>安全<br>数据库可以授权，但不能授权到数据库特定行和特定的列上。通过视图可以让用户只能查询和修改他们所能见到的数据  </li>
<li>数据独立<br>视图可帮助用户屏蔽真实表结构变化带来的影响。</li>
</ul>
<blockquote>
<p>总而言之，视图类似于给表加上一个外壳，用户通过这个外壳访问表的时候，只能按照所设计的方式进行访问与更新。</p>
</blockquote>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>存储过程是事先经过编译并存储在数据库中的一段SQL语句的集合，即语言层面的代码封装与重用。调用存储过程可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，提高数据处理的效率。</p>
<p><strong>特点:</strong></p>
<ul>
<li>封装</li>
<li>复用</li>
<li>可以接收参数，也可以返回数据</li>
<li>减少网络交互，提升效率</li>
</ul>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><ul>
<li><p>创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> 存储过程名称( [参数列表] ) <br><span class="hljs-keyword">BEGIN</span><br>	<span class="hljs-keyword">SQL</span> 语句 <br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure>
<p>注: 在命令行中，执行创建存储过程的SQL时，需要通过关键字delimiter更换SQL语句的结束符。默认是分号作为结束符。</p>
</li>
<li><p>调用<br><code>CALL 名称 ([参数]);</code></p>
</li>
<li><p>查看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询指定数据库的存储过程及状态信息</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.ROUTINES <span class="hljs-keyword">WHERE</span> ROUTINE_SCHEMA <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;xxx&#x27;</span>;<br><span class="hljs-comment">-- 查询某个存储过程的定义</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> 存储过程名称;<br></code></pre></td></tr></table></figure>
</li>
<li><p>删除<br><code>DROP PROCEDURE [ IF EXISTS ] 存储过程名称;</code></p>
</li>
</ul>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><h4 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h4><p>  由MySQL服务器提供，分全局Global变量、会话Session变量</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看所有系统变量</span><br><span class="hljs-keyword">SHOW</span> [ SESSION <span class="hljs-operator">|</span> <span class="hljs-keyword">GLOBAL</span> ] VARIABLES;<br><span class="hljs-comment">-- 可以通过LIKE模糊匹配方式查找变量</span><br><span class="hljs-keyword">SHOW</span> [ SESSION <span class="hljs-operator">|</span> <span class="hljs-keyword">GLOBAL</span> ] VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;......&#x27;</span>; <br><span class="hljs-comment">-- 查看指定变量的值</span><br><span class="hljs-keyword">SELECT</span> @@[SESSION <span class="hljs-operator">|</span> <span class="hljs-keyword">GLOBAL</span>].系统变量名;<br><br><span class="hljs-comment">-- 设置系统变量，默认作用域 session</span><br><span class="hljs-comment">-- MySQL服务重启后全局参数会复原。如要永久修改参数，需要修改MySQL的配置文件</span><br><span class="hljs-keyword">SET</span> [ SESSION <span class="hljs-operator">|</span> <span class="hljs-keyword">GLOBAL</span> ] 系统变量名 <span class="hljs-operator">=</span> 值 ;<br><span class="hljs-keyword">SET</span> @@[ SESSION <span class="hljs-operator">|</span> <span class="hljs-keyword">GLOBAL</span> ].系统变量名 <span class="hljs-operator">=</span> 值 ;<br></code></pre></td></tr></table></figure>

<h4 id="用户定义变量"><a href="#用户定义变量" class="headerlink" title="用户定义变量"></a>用户定义变量</h4><p>  用户根据需要自己定义的变量，不需要提前声明，用的时候直接用<code>@变量名</code>即可。未声明或者未初始化则默认为null。作用域为当前会话。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 赋值1</span><br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@var</span>_name <span class="hljs-operator">=</span> expr [, <span class="hljs-variable">@var</span>_name <span class="hljs-operator">=</span> expr] ... ;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@var</span>_name :<span class="hljs-operator">=</span> expr [, <span class="hljs-variable">@var</span>_name :<span class="hljs-operator">=</span> expr] ... ;<br><br><span class="hljs-comment">-- 赋值2</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@var</span>_name :<span class="hljs-operator">=</span> expr [, <span class="hljs-variable">@var</span>_name :<span class="hljs-operator">=</span> expr] ... ;<br><br><span class="hljs-comment">-- 赋值3</span><br><span class="hljs-keyword">SELECT</span> 字段名 <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@var</span>_name <span class="hljs-keyword">FROM</span> 表名;<br></code></pre></td></tr></table></figure>

<h4 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h4><p>  根据需要定义在局部块的变量，访问之前需要DECLARE声明。可用作存储过程的局部变量和输入参数。作用范围是声明所在的BEGIN…END块中</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 声明</span><br><span class="hljs-keyword">DECLARE</span> 变量名 变量类型 [<span class="hljs-keyword">DEFAULT</span> ... ] ;<br><br><span class="hljs-comment">-- 赋值</span><br><span class="hljs-keyword">SET</span> 变量名 <span class="hljs-operator">=</span> 值 ;<br><span class="hljs-keyword">SET</span> 变量名 :<span class="hljs-operator">=</span> 值 ;<br><span class="hljs-keyword">SELECT</span> 字段名 <span class="hljs-keyword">INTO</span> 变量名 <span class="hljs-keyword">FROM</span> 表名 ... ;<br></code></pre></td></tr></table></figure>

<h3 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h3><h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">IF 条件<span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span><br>  .....<br>ELSEIF 条件<span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span>   <span class="hljs-comment">-- 可选</span><br>  .....<br><span class="hljs-keyword">ELSE</span> <span class="hljs-comment">-- 可选</span><br>  .....<br><span class="hljs-keyword">END</span> IF;<br></code></pre></td></tr></table></figure>

<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>类型</th>
<th>含义</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>IN</td>
<td>该类参数作为输入，调用时需要传入值</td>
<td>默认</td>
</tr>
<tr>
<td>OUT</td>
<td>该类参数作为输出，作为调用的返回值</td>
<td></td>
</tr>
<tr>
<td>INOUT</td>
<td>既可以作为输入参数，也可以作为输出参数</td>
<td></td>
</tr>
</tbody></table>
<p>  示例：<br>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> p4(<span class="hljs-keyword">in</span> score <span class="hljs-type">int</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">result</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>))<br><span class="hljs-keyword">begin</span><br>  if score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">85</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> :<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;优秀&#x27;</span>;<br>  elseif score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">60</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> :<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;及格&#x27;</span>;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">set</span> <span class="hljs-keyword">result</span> :<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;不及格&#x27;</span>;<br>  <span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">end</span>;<br><br><span class="hljs-keyword">call</span> p4(<span class="hljs-number">18</span>, <span class="hljs-variable">@result</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-variable">@result</span>;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> p5(<span class="hljs-keyword">inout</span> score <span class="hljs-keyword">double</span>)<br><span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">set</span> score :<span class="hljs-operator">=</span> score <span class="hljs-operator">*</span> <span class="hljs-number">0.5</span>;<br><span class="hljs-keyword">end</span>;<br><br><span class="hljs-keyword">set</span> <span class="hljs-variable">@score</span> <span class="hljs-operator">=</span> <span class="hljs-number">198</span>;<br><span class="hljs-keyword">call</span> p5(<span class="hljs-variable">@score</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-variable">@score</span>;<br></code></pre></td></tr></table></figure></p>
<h4 id="case"><a href="#case" class="headerlink" title="case"></a>case</h4>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 语法1 - 值判断</span><br><span class="hljs-keyword">CASE</span> case_value<br>  <span class="hljs-keyword">WHEN</span> when_value1 <span class="hljs-keyword">THEN</span> statement_list1<br>  [ <span class="hljs-keyword">WHEN</span> when_value2 <span class="hljs-keyword">THEN</span> statement_list2] ...<br>  [ <span class="hljs-keyword">ELSE</span> statement_list ]<br><span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;<br><br><span class="hljs-comment">-- 语法2 - 逻辑判断</span><br><span class="hljs-keyword">CASE</span><br>  <span class="hljs-keyword">WHEN</span> search_condition1 <span class="hljs-keyword">THEN</span> statement_list1<br>  [<span class="hljs-keyword">WHEN</span> search_condition2 <span class="hljs-keyword">THEN</span> statement_list2] ...<br>  [<span class="hljs-keyword">ELSE</span> statement_list]<br><span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;<br><br><span class="hljs-comment">-- 注：如果判定条件有多个，多个条件之间可以使用 and 或 or 进行连接。</span><br></code></pre></td></tr></table></figure>

<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- while - 先判定条件，如果条件为true，则执行逻辑，否则，不执行逻辑</span><br>WHILE 条件 DO<br>  <span class="hljs-keyword">SQL</span>逻辑...<br><span class="hljs-keyword">END</span> WHILE;<br><br><span class="hljs-comment">-- repeat - 先执行一次逻辑，然后判定UNTIL条件是否满足，如果满足，则退出。如果不满足，则继续下一次循环</span><br>REPEAT<br>  <span class="hljs-keyword">SQL</span>逻辑...<br>  UNTIL 条件<br><span class="hljs-keyword">END</span> REPEAT;<br><br><span class="hljs-comment">-- loop - 配合leave, iterate使用</span><br>[label:] LOOP<br>  <span class="hljs-keyword">SQL</span>逻辑...<br><br>  <span class="hljs-comment">-- 退出指定标记的循环体</span><br>  leave lable;<br>  <span class="hljs-comment">-- 直接进入下一次循环</span><br>  iterate lable;<br><span class="hljs-keyword">END</span> LOOP [label];<br></code></pre></td></tr></table></figure>

<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><p>游标（CURSOR）是用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环的处理。</p>
<ul>
<li><p>声明游标：<br><code>DECLARE 游标名称 CURSOR FOR 查询语句</code></p>
</li>
<li><p>打开游标：<br><code>OPEN 游标名称</code></p>
</li>
<li><p>获取游标记录：<br><code>FETCH 游标名称 INTO 变量 [ ,变量 ]</code></p>
</li>
<li><p>关闭游标<br><code> CLOSE 游标名称</code></p>
</li>
</ul>
<p><strong>条件处理程序：</strong><br>条件处理程序（Handler）可以用来定义在流程控制结构执行过程中遇到问题时相应的处理步骤。<br>具体语法为：<br><code>DECLARE handler_action HANDLER FOR condition_value [, condition value] ... statement</code><br>其中，handler_action 的取值有：</p>
<ul>
<li>CONTINUE：继续执行当前程序</li>
<li>EXIT：终止执行当前程序</li>
</ul>
<p>condition_value 的取值有:</p>
<ul>
<li><code>SQLSTATE sqlstate_value</code>：指定状态码，如02000</li>
<li><code>SQLWARNING</code>：所有以01开头的SQLSTATE代码的简写</li>
<li><code>NOT FOUND</code>：所有以02开头的SQLSTATE代码的简写</li>
<li><code>SQLEXCEPTION</code>：所有没被 SQLWARNING 或 NOT FOUND 捕获的SQLSTATE代码的简写</li>
</ul>
<p>示例：<br>根据传入的参数uage，来查询用户表tb_user中，所有的用户年龄小于等于uage的用户姓名（name）和专业（profession），并将用户的姓名和专业插入到所创建的一张新表（id，name，profession）中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> p1l(<span class="hljs-keyword">in</span> uage <span class="hljs-type">int</span>)<br>  <span class="hljs-keyword">begin</span><br>    <span class="hljs-comment">-- 注：必须先声明普通变量，再声明游标</span><br>    <span class="hljs-keyword">declare</span> uname <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>); <br>    <span class="hljs-keyword">decLare</span> upro <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);<br>    <span class="hljs-comment">-- 声明游标</span><br>    <span class="hljs-keyword">declare</span> u_cursor <span class="hljs-keyword">cursor</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">select</span> name,profession <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;=</span> uage; <br><br>    <span class="hljs-comment">-- 当条件处理程序的处理的状态码为02000的时候，就会退出。</span><br>    <span class="hljs-keyword">declare</span> exit handler <span class="hljs-keyword">for</span> <span class="hljs-keyword">SQLSTATE</span> <span class="hljs-string">&#x27;02000&#x27;</span> <span class="hljs-keyword">close</span> u_cursor;<br><br>    <span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> tb_user_pro; <br>    <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> tb_user_pro(<br>      id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key auto_increment, <br>      name <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>), <br>      profession <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)<br>    );<br>    <span class="hljs-comment">-- 开启游标</span><br>    <span class="hljs-keyword">open</span> u_cursor;<br>    <br>    while <span class="hljs-literal">true</span> do<br>      <span class="hljs-comment">-- 获取游标中的记录</span><br>      <span class="hljs-keyword">fetch</span> u_cursor <span class="hljs-keyword">into</span> uname,Upro;<br>      <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user_pro <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>, uname, upro); <br>    <span class="hljs-keyword">end</span> while;<br><br>    <span class="hljs-keyword">close</span> u_cursor;<br>  <span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>


<h2 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h2><p>存储函数是有返回值的存储过程，存储函数的参数只能是 IN 类型。但一般都可以用存储过程替换。</p>
<p><strong>语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> 存储函数名称 ([ 参数列表 ])<br><span class="hljs-keyword">RETURNS</span> type [characteristic ...]<br><span class="hljs-keyword">BEGIN</span><br>  <span class="hljs-comment">-- SQL语句</span><br>  <span class="hljs-keyword">RETURN</span> ...;<br><span class="hljs-keyword">END</span> ;<br></code></pre></td></tr></table></figure>

<p>其中，characteristic可选值有：</p>
<ul>
<li>DETERMINISTIC：相同的输入参数总是产生相同的结果</li>
<li>NO SQL ：不包含 SQL 语句。</li>
<li>READS SQL DATA：包含读取数据的语句，但不包含写入数据的语句。</li>
</ul>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器是与表有关的数据库对象，指在insert&#x2F;update&#x2F;delete之前或之后，触发并执行触发器中定义的SQL语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性，日志记录，数据校验等操作。   </p>
<p>触发器使用别名OLD和NEW来引用触发器中发生变化的记录内容。目前MySQL触发器只支持行级触发，不支持语句级触发，即变化的行数就是触发器执行的次数。</p>
<table>
<thead>
<tr>
<th>触发器类型</th>
<th>NEW 和 OLD</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>NEW 表示将要或者已经新增的数据</td>
</tr>
<tr>
<td>UPDATE</td>
<td>OLD表示修改之前的数据，NEW表示将要或已经修改后的数据</td>
</tr>
<tr>
<td>DELETE</td>
<td>OLD表示将要或者已经删除的数据</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> trigger_name<br>BEFORE<span class="hljs-operator">/</span>AFTER <span class="hljs-keyword">INSERT</span><span class="hljs-operator">/</span><span class="hljs-keyword">UPDATE</span><span class="hljs-operator">/</span><span class="hljs-keyword">DELETE</span><br><span class="hljs-keyword">ON</span> tbl_name <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-comment">-- 行级触发器</span><br><span class="hljs-keyword">BEGIN</span><br>  trigger_stmt;<br><span class="hljs-keyword">END</span>;<br><br><span class="hljs-comment">-- 查看</span><br><span class="hljs-keyword">SHOW</span> TRIGGERS;<br><br><span class="hljs-comment">-- 删除</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TRIGGER</span> [schema_name.]trigger_name;<br></code></pre></td></tr></table></figure>


<h2 id="锁-⭐⭐⭐"><a href="#锁-⭐⭐⭐" class="headerlink" title="锁 ⭐⭐⭐"></a>锁 ⭐⭐⭐</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制。在数据库中，除传统的计算资源（CPU、RAM、I&#x2F;O）的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
</blockquote>
<p>MySQL中的锁，按照锁的粒度分，分为以下三类：</p>
<ol>
<li>全局锁：锁定数据库中的所有表。</li>
<li>表级锁：每次操作锁住整张表。</li>
<li>行级锁：每次操作锁住对应的行数据。</li>
</ol>
<h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><blockquote>
<p>全局锁就是对整个数据库实例加锁，是一个重操作，加锁后整个实例就处于只读状态，后续的DML写语句，DDL语句，以及更新操作的事务提交语句都将被阻塞。全局锁典型的使用场景是做全库的逻辑备份，对所有的表进行锁定，从而获取一致性视图，保证数据的完整性。  </p>
</blockquote>
<p><strong>语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 加全局锁</span><br>flush tables <span class="hljs-keyword">with</span> read lock;<br><span class="hljs-comment">-- 数据备份</span><br>mysqldump <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> db_name <span class="hljs-operator">&gt;</span> backup_path<br><span class="hljs-comment">-- 释放锁</span><br>unlock tables;<br></code></pre></td></tr></table></figure>

<p><strong>特点：</strong></p>
<ul>
<li>如果在主库上备份，那么在备份期间都不能执行更新，业务基本上就得停摆。</li>
<li>如果在从库上备份，那么在备份期间从库不能执行主库同步过来的二进制日志（binlog），导致主从延迟。</li>
<li>InnoDB引擎中，可以在备份时加上<code>--single-transaction</code>参数完成不加锁的一致性数据备份</li>
</ul>
<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><blockquote>
<p>表级锁，每次操作锁住整张表。锁定粒度大，发生锁冲突的概率最高，并发度最低。应用在MyISAM、InnoDB、BDB等存储引擎中。表级锁主要分为<strong>表锁、元数据锁、意向锁</strong>三类。</p>
</blockquote>
<h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><p><strong>分类：</strong></p>
<ul>
<li>表共享读锁（read lock）: 所有事务（包括当前加锁的客户端）都只能读，不能写 </li>
<li>表独占写锁（write lock）: 当前加锁的客户端可读可写，其他客户端不可读也不可写。</li>
</ul>
<p><strong>语法：</strong></p>
<ul>
<li>加锁：<code>lock tables tb_name... read/write</code></li>
<li>解锁: <code>unlock tables</code> 或 断开客户端连接</li>
</ul>
<h4 id="元数据锁（Meta-Data-Lock，MDL）"><a href="#元数据锁（Meta-Data-Lock，MDL）" class="headerlink" title="元数据锁（Meta Data Lock，MDL）"></a>元数据锁（Meta Data Lock，MDL）</h4><p>MDL加锁过程是系统自动控制，无需显式使用，在访问一张表的时候会自动加上。MDL锁主要作用是维护表元数据的一致性，避免DML与DDL冲突，保证读写的正确性。也就是说表上有活动事务的时候，不可以对元数据进行写入操作。</p>
<p>当对一张表进行增删改查的时候，加元数据共享锁;当对表结构进行变更操作的时候，加元数据排他锁。具体SQL语句的加锁如下：</p>
<table>
<thead>
<tr>
<th>对应SQL</th>
<th>锁类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>lock tables xxx read &#x2F;write</td>
<td>SHARED_READ_ONLY &#x2F;SHARED_NO_READ_WRITE</td>
<td></td>
</tr>
<tr>
<td>select, select … lock in share mode</td>
<td>SHARED_READ</td>
<td>与SHARED_READ、SHARED_WRITE兼容，与EXCLUSIVE互斥</td>
</tr>
<tr>
<td>insert 、update、delete、select … for update</td>
<td>SHARED_WRITE</td>
<td>与SHARED_READ、SHARED_WRITE兼容，与EXCLUSIVE互斥</td>
</tr>
<tr>
<td>alter table …</td>
<td>EXCLUSIVE</td>
<td>与其他的MDL都互斥</td>
</tr>
</tbody></table>
<p>查看当前数据库中的加锁情况：<br><code>select object_type, object_schema, object_name,lock_type, lock_duration from performance_schema.metadata_locks;</code></p>
<h4 id="意向锁（Intention-Lock）"><a href="#意向锁（Intention-Lock）" class="headerlink" title="意向锁（Intention Lock）"></a>意向锁（Intention Lock）</h4><p>为了避免DML在执行时，加的行锁与表锁冲突造成性能降低，InnoDB中引入了意向锁，使得表锁不用检查每行数据是否加锁，使用意向锁来减少表锁的检查。  </p>
<p>引入意向锁后，如果一个客户端对某一行加上了行锁，那么系统会自动对其加上意向锁，当别的客户端试图对其加上表锁时，便会检查意向锁是否兼容，若是不兼容，便会阻塞直到意向锁释放。  </p>
<p><strong>意向锁兼容性：</strong></p>
<ul>
<li>意向共享锁（IS）：与表锁的共享读锁兼容，与表锁独占写锁互斥。由<code>select ... lock in share mode;</code>添加</li>
<li>意向排他锁（lX）：与表锁的共享读锁及独占写锁都互斥。由<code>insert, update, delete, select ... for update</code>添加</li>
</ul>
<p>注：意向锁之间不会互斥。一旦事务提交，IS、IX 都会自动释放。</p>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><blockquote>
<p>每次操作锁住对应的行数据。锁定粒度最小，发生锁冲突的概率最低，并发度最高。应用在InnoDB存储引擎中。InnoDB数据基于索引组织，行级锁通过对索引上的索引项进行加锁实现，而不是对记录加锁。行级锁主要分为<strong>行锁、间隙锁、临键锁</strong>三类。</p>
</blockquote>
<h4 id="行锁（Record-Lock）"><a href="#行锁（Record-Lock）" class="headerlink" title="行锁（Record Lock）"></a>行锁（Record Lock）</h4><p>锁定单个行记录的锁，防止其他事务对此行进行update和delete。在RC（read commit ）、RR（repeatable read）隔离级别下都支持。</p>
<p><strong>分类：</strong></p>
<ul>
<li>共享锁S：允许获取共享锁的事务读行记录，阻止其他事务获得相同数据集的排它锁。</li>
<li>排他锁X：允许获取排他锁的事务更新数据，阻止其他事务获得相同数据集的共享锁和排他锁。</li>
</ul>
<p>即共享锁和共享锁之间相互兼容，排他锁和其它任何锁都冲突。</p>
<table>
<thead>
<tr>
<th>SQL</th>
<th>行锁类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>insert</td>
<td>排他锁</td>
<td>自动加锁</td>
</tr>
<tr>
<td>update</td>
<td>排他锁</td>
<td>自动加锁</td>
</tr>
<tr>
<td>delete</td>
<td>排他锁</td>
<td>自动加锁</td>
</tr>
<tr>
<td>select</td>
<td>不加锁</td>
<td></td>
</tr>
<tr>
<td>select … lock in share mode</td>
<td>共享锁</td>
<td>需手动在SELECT之后加LOCK IN SHARE MODE</td>
</tr>
<tr>
<td>SELECT … for update</td>
<td>排他锁</td>
<td>需手动在SELECT之后加FOR UPDATE</td>
</tr>
</tbody></table>
<p>注：</p>
<ul>
<li>针对唯一索引进行检索时，对已存在的记录进行等值匹配时，将会自动优化为行锁。</li>
<li>InnoDB的行锁是针对于索引加的锁，不通过索引条件检索数据，那么InnoDB将对表中的所有记录加锁，此时就会升级为表锁。</li>
</ul>
<h4 id="间隙锁（Gap-Lock）-amp-临键锁（Next-Key-Lock）："><a href="#间隙锁（Gap-Lock）-amp-临键锁（Next-Key-Lock）：" class="headerlink" title="间隙锁（Gap Lock）&amp; 临键锁（Next-Key Lock）："></a>间隙锁（Gap Lock）&amp; 临键锁（Next-Key Lock）：</h4><p>间隙锁对索引记录间隙（不含该记录）加锁，确保索引记录间隙不变，防止其他事务在这个间隙进行insert，产生幻读。例如两个临近叶子节点为15和23，那么间隙就是指开区间(15 , 23)，锁的就是这个间隙。间隙锁可以共存，一个事务采用的间隙锁不会阻止另一个事务在同一间隙上采用间隙锁。</p>
<p>而临键锁是行锁和间隙锁的组合，同时锁住数据和数据前面的间隙Gap。在RR隔离级别下支持。默认情况下，InnoDB在REPEATABLE READ事务隔离级别运行，InnoDB使用临键锁进行搜索和索引扫描，以防止幻读。</p>
<p>注：</p>
<ul>
<li>索引上的等值查询（唯一索引），给不存在的记录加锁时，优化为间隙锁。</li>
<li>索引上的等值查询（普通索引），向右遍历时最后一个值不满足查询需求时，临键锁退化为间隙锁。</li>
<li>索引上的范围查询（唯一索引），会访问到不满足条件的第一个值为止。</li>
</ul>
<h2 id="InnoDB-引擎"><a href="#InnoDB-引擎" class="headerlink" title="InnoDB 引擎"></a>InnoDB 引擎</h2><h3 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h3><img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload class="" title="alt">

<ul>
<li><p>表空间<br>表空间是InnoDB逻辑结构的最高层，如果用户启用了参数 innodb_file_per_table(在8.0版本中默认开启)，则每张表都会有一个表空间（xxx.ibd文件）。一个mysql实例可以对应多个表空间，用于存储记录、索引等数据。</p>
</li>
<li><p>段<br>分为数据段（Leaf node segment）、索引段（Non-leaf node segment）、回滚段（Rollback segment）。InnoDB是索引组织表，数据段就是B+树的叶子节点，索引段即B+树的非叶子节点。段用来管理多个Extent（区）。</p>
</li>
<li><p>区<br>表空间的单元结构，每个区的大小为1M。默认情况下，InnoDB存储引擎页大小为16K，即一个区中一共有64个连续的页。</p>
</li>
<li><p>页<br>是InnoDB磁盘管理的最小单元，每个页的大小默认为16KB。为了保证页的连续性，InnoDB引擎每次从磁盘申请4-5个区。一页包含若干行。</p>
</li>
<li><p>行<br>InnoDB存储引擎按行存放数据。行中有两个隐藏字段 Trx_id（最近一次行更新对应的事务id）, Roll_pointer（找到该记录修改前的信息）</p>
</li>
</ul>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p><strong>InnoDB整体业务逻辑：</strong><br>  当业务操作的时候直接操作的是内存缓冲区，如果缓冲区当中没有数据，则会从磁盘中加载到缓冲区，增删改查都是在缓冲区的，后台线程以一定的速率刷新到磁盘。</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84.png" srcset="/img/loading.gif" lazyload class="" title="alt InnoDB存储架构">

<h4 id="内存结构"><a href="#内存结构" class="headerlink" title="内存结构"></a>内存结构</h4><img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload class="" title="alt 内存结构">

<ul>
<li><p><strong>Buffer Pool</strong><br>缓冲池是主内存中的一个区域，可以缓存磁盘上经常操作的数据。在执行增删改查操作时，先操作缓冲池中的数据（若缓冲池没有数据，则从磁盘加载并缓存），然后再以一定频率刷新到磁盘，从而减少磁盘I0，加快处理速度。</p>
<p>缓冲池以Page页为单位，底层采用链表数据结构管理Page。根据状态将Page分为三种类型：</p>
<ul>
<li>free page：空闲page，未被使用</li>
<li>clean page：被使用的page，数据没有被修改过</li>
<li>dirty page：脏页，被使用过，且数据被修改过，即内存数据和磁盘数据不一致</li>
</ul>
</li>
<li><p><strong>Change Buffer</strong><br>更改缓冲区，针对非唯一二级索引页。在执行DML语句时，如果这些数据Page没有在Buffer Pool中，不会直接操作磁盘，而会将数据变更记录在 Change Buffer 中，在未来数据被读取时，再将数据合并恢复到Buffer Pool中，再将合并后的数据刷新到磁盘中。</p>
<p>与聚集索引不同，二级索引通常是非唯一的，并且以相对随机的顺序插入二级索引。同样，删除和更新可能会影响索引树中不相邻的二级索引页，如果每一次都操作磁盘，会造成大量的磁盘IO。有了 ChangeBuffer 之后，我们可以在缓冲池中进行合并处理，减少磁盘IO。</p>
</li>
<li><p><strong>Adaptive Hash Index</strong><br>自适应hash索引，用于优化对Buffer Pool数据的查询。MySQL的innoDB引擎中虽然没有直接支持hash索引，但是给我们提供了自适应hash索引。hash索引在进行等值匹配时，一般性能是要高于B+树的，但是hash索引不适合做范围查询、模糊匹配等。InnoDB存储引擎会监控对表上各索引页的查询，如果观察到在特定的条件下hash索引可以提升速度，则建立hash索引，称之为自适应hash索引。</p>
<p>InnoDB的自适应哈希索引，无需人工干预，由系统根据情况自动完成。</p>
</li>
<li><p><strong>Log Buffer</strong><br>日志缓冲区，用于保存要写入到磁盘中的log日志数据（redo log 、undo log）。默认大小为16MB，日志缓冲区的日志会定期刷新到磁盘中。如果需要更新、插入或删除多行的事务，增加日志缓冲区的大小可以节省磁盘 I&#x2F;O。</p>
<p>涉及参数：</p>
<ul>
<li>innodb_log_buffer_size 缓冲区大小</li>
<li>innodb_flush_log_at_trx_commit 日志刷新到磁盘时机，取值有三个：<ul>
<li>0：每秒将日志写入并刷新到磁盘一次</li>
<li>1：默认值，日志在每次事务提交时写入并刷新到磁盘</li>
<li>2：日志在每次事务提交后写入，并每秒刷新到磁盘一次</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="磁盘结构"><a href="#磁盘结构" class="headerlink" title="磁盘结构"></a>磁盘结构</h4><img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/InnoDB%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload class="" title="alt 磁盘结构">

<ul>
<li><p>System Tablespace<br>系统表空间是更改缓冲区的存储区域。如果表是在系统表空间而不是每个表文件或通用表空间中创建的，它也可能包含表和索引数据。参数 innodb_data_file_path，默认文件为ibdata1。</p>
</li>
<li><p>File-Per-Table Tablespaces<br>如果开启了innodb_file_per_table开关，则每个表的文件表空间包含单个InnoDB表的数据和索引 ，并存储在文件系统上的单个数据文件中。</p>
</li>
<li><p>General Tablespaces<br>通用表空间，需要通过 CREATE TABLESPACE 语法创建通用表空间，在创建表时，可以指定该表空间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建表空间</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>SPACE ts_name <span class="hljs-keyword">ADD</span> DATAFILE <span class="hljs-string">&#x27;file_name&#x27;</span> ENGINE <span class="hljs-operator">=</span> engine_name;<br><span class="hljs-comment">-- 创建表时指定表空间</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> xxx ... TABLESPACE ts_name;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Undo Tablespaces<br>撤销表空间，MySQL实例在初始化时会自动创建两个默认的undo表空间（初始大小16M），用于存储undo log日志。</p>
</li>
<li><p>Temporary Tablespaces<br>InnoDB 使用会话临时表空间和全局临时表空间，存储用户创建的临时表等数据。</p>
</li>
<li><p>Doublewrite Buffer Files<br>双写缓冲区，InnoDB引擎将数据页从Buffer Pool刷新到磁盘前，先将数据页写入双写缓冲区文件中，便于系统异常时恢复数据。</p>
</li>
<li><p>Redo Log<br>重做日志，是用来实现事务的持久性。该日志文件由两部分组成：重做日志缓冲（redo log buffer）以及重做日志文件（redo log），前者是在内存中，后者在磁盘中。当事务提交之后会把所有修改信息存到该日志中, 用于在刷新脏页到磁盘发生错误时, 进行数据恢复。</p>
</li>
</ul>
<h4 id="后台线程"><a href="#后台线程" class="headerlink" title="后台线程"></a>后台线程</h4><p>在InnoDB的后台线程中，分为4类，分别是：Master Thread 、IO Thread、Purge Thread、Page Cleaner Thread。</p>
<ul>
<li><p>Master Thread<br>核心后台线程，负责调度其他线程，还负责将缓冲池中的数据异步刷新到磁盘中, 保持数据的一致性，还包括脏页的刷新、合并插入缓存、undo页的回收。</p>
</li>
<li><p>IO Thread<br>在InnoDB存储引擎中大量使用了AIO(异步IO)来处理IO请求, 这样可以极大地提高数据库的性能，而IO Thread主要负责这些IO请求的回调。可以通过<code>show engine innodb status;</code> 查询当前后台线程的状态。</p>
<table>
<thead>
<tr>
<th>线程类型</th>
<th>默认个数</th>
<th>职责</th>
</tr>
</thead>
<tbody><tr>
<td>Read Thread</td>
<td>4</td>
<td>负责读操作</td>
</tr>
<tr>
<td>Write Thread</td>
<td>4</td>
<td>负责写操作</td>
</tr>
<tr>
<td>Log Thread</td>
<td>1</td>
<td>负责将日志缓冲区刷新到磁盘</td>
</tr>
<tr>
<td>Insert Buffer Thread</td>
<td>1</td>
<td>负责将写缓冲区内容刷新到磁盘</td>
</tr>
</tbody></table>
</li>
<li><p>Purge Thread<br>主要用于回收事务已经提交了的undo log，在事务提交之后，undo log可能不用了，就用它来回收。</p>
</li>
<li><p>Page Cleaner Thread<br>协助 Master Thread 刷新脏页到磁盘的线程，它可以减轻 Master Thread 的工作压力，减少阻塞。</p>
</li>
</ul>
<h3 id="事务原理"><a href="#事务原理" class="headerlink" title="事务原理"></a>事务原理</h3><p>事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p>
<p>事务的四大特征ACID：</p>
<ul>
<li>原子性（Atomicity）：事务是不可分割的最小操作单元，要么全部成功，要么全部失败。依赖于undo log。</li>
<li>一致性（Consistency）：事务完成时，必须使所有的数据都保持一致状态。依赖于undo log + redo log。</li>
<li>隔离性（Isolation）：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。依赖于锁机制 + MVCC。</li>
<li>持久性（Durability）：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。依赖于redo log。</li>
</ul>
<p>其中，原子性，一致性，持久性这三大特性由 redo log 和 undo log 两份日志来保证。而隔离性由锁机制和MVCC保证。</p>
<h4 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h4><p>重做日志，记录的是事务提交时数据页的物理修改，用来实现事务的持久性。<br>该日志文件由两部分组成：重做日志缓冲（redo log buffer）以及重做日志文件（redo log file），前者在内存中，后者在磁盘中。当事务提交之后会把所有修改信息都存到该日志文件中，用于在刷新脏页到磁盘发生错误时，进行数据恢复使用。</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/redo_log.png" srcset="/img/loading.gif" lazyload class="" title="alt redo_log">

<blockquote>
<ol>
<li>有了redolog之后，当对缓冲区的数据进行增删改之后，会首先将操作的数据页的变化，记录在redo log buffer中。在事务提交时，会将redo log buffer中的数据刷新到redo log磁盘文件中。过一段时间之后，如果刷新缓冲区的脏页到磁盘时，发生错误，此时就可以借助于redo log进行数据恢复，这样就保证了事务的持久性。</li>
<li>事物每次提交的时候都会将数据刷到redo log中而不是直接将buffer pool中的数据直接刷到磁盘中（ibd文件中），是因为redo log 是顺序写，性能处理的够快，直接刷到ibd中，是随机写，性能慢。所以脏页是在下一次读的时候，或者后台线程采用一定的机制进行刷盘到ibd中。<br>这种先写日志的方式，称为 WAL(Write-Ahead Logging)</li>
</ol>
</blockquote>
<h4 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h4><p>回滚日志，用于记录数据被修改前的信息，作用包括提供回滚（提供事务原子性）和MVCC（多版本并发控制）。</p>
<p>undo log不同于redo log记录物理日志，它是逻辑日志。可以认为当delete一条记录，undo log中会记录一条对应的insert记录，反之亦然，当update一条记录时，它记录一条对应相反的update记录。当执行rollback时，就可以从undo log中的逻辑记录读取到相应的内容并进行回滚。  </p>
<blockquote>
<ol>
<li>undo log 销毁：undo log在事务执行时产生，事务提交时，并不会立即删除undo log，因为这些日志可能还用于MVCC。</li>
<li>undo log 存储：undo log采用段的方式进行管理和记录，存放在rollback segment回滚段中，内部包含1024个undo log segment。</li>
</ol>
</blockquote>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><ul>
<li><p>当前读<br>读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。对于我们日常的操作，如：</p>
<ul>
<li>select…lock in share mode（共享锁）。</li>
<li>select..…for update、update、insert、delete（排他锁）<br>都是一种当前读。</li>
</ul>
</li>
<li><p>快照读<br>简单的select（不加锁）就是快照读，读取的是记录数据的可见版本，有可能是历史数据，不加锁，是非阻塞读。</p>
<ul>
<li>Read Committed：每次select，都生成一个快照读。</li>
<li>Repeatable Read：开启事务后第一个select语句才是快照读的地方。</li>
<li>Serializable：快照读会退化为当前读。</li>
</ul>
</li>
</ul>
<p>MVCC 全称 Multi-Version Concurrency Control 多版本并发控制。指维护一个数据的多个版本，使得读写操作没有冲突，快照读为MySQL实现MVCC提供了一个非阻塞读功能。MVCC的具体实现，还需要依赖于数据库记录中的<strong>三个隐式字段、undo log、readview</strong>。</p>
<ul>
<li><p><strong>三个隐式字段</strong></p>
<table>
<thead>
<tr>
<th>隐式字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>DB_TRX_ID</td>
<td>最近修改事务ID，记录插入这条记录或最后一次修改该记录的事务ID</td>
</tr>
<tr>
<td>DB_ROLL_PTR</td>
<td>回滚指针，指向这条记录的上一个版本，用于配合undo log，指向上一个版本</td>
</tr>
<tr>
<td>DB_ROW_ID</td>
<td>隐藏主键，如果表结构没有指定主键，将会生成该隐藏字段</td>
</tr>
</tbody></table>
<p>其中，前两个字段必然会添加的，是否添加最后一个字段DB_ROW_ID，得看当前表有没有主键，如果有主键，则不会添加该隐藏字段。</p>
</li>
<li><p><strong>undo log</strong></p>
<ul>
<li>回滚日志，在insert、update、delete的时候产生的便于数据回滚的日志。</li>
<li>当insert的时候，产生的undo log日志只在回滚时需要，在事务提交后，可被立即删除。</li>
<li>而update、delete的时候，产生的undo log日志不仅在回滚时需要，在快照读时也需要，不会立即被删除。</li>
</ul>
<p>版本链：</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/undo_log_%E7%89%88%E6%9C%AC%E9%93%BE.png" srcset="/img/loading.gif" lazyload class="" title="alt undo_log_版本链">

<p>不同事务或相同事务对同一条记录进行修改，会导致该记录的undolog生成一条记录版本链表，链表的头部是最新的旧记录，链表尾部是最早的旧记录。</p>
</li>
<li><p><strong>readview</strong><br>读视图是快照读SQL执行时MVCC提取数据的依据，记录并维护系统当前活跃的未提交事务id。</p>
<p>四个核心字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>m_ids</td>
<td>当前活跃的事务ID集合</td>
</tr>
<tr>
<td>min_trx_id</td>
<td>最小活跃事务ID</td>
</tr>
<tr>
<td>max_trx_id</td>
<td>预分配事务ID，当前最大事务ID+1（因为事务ID是自增的）</td>
</tr>
<tr>
<td>creator_trx_id</td>
<td>ReadView创建者的事务ID</td>
</tr>
</tbody></table>
<p>版本链数据的访问规则：</p>
<table>
<thead>
<tr>
<th>条件</th>
<th>是否可以访问</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>trx_id &#x3D;&#x3D; creator_trx_id</td>
<td>可以访问该版本</td>
<td>成立，说明数据是当前这个事务更改的</td>
</tr>
<tr>
<td>trx_id &lt; min_trx_id</td>
<td>可以访问该版本</td>
<td>成立，说明数据已经提交了</td>
</tr>
<tr>
<td>trx_id &gt; max_trx_id</td>
<td>不可以访问该版本</td>
<td>成立，说明该事务是在ReadView生成后才开启</td>
</tr>
<tr>
<td>min_trx_id &lt;&#x3D; trx_id &lt;&#x3D; max_trx_id</td>
<td>如果trx_id不在m_ids中，是可以访问该版本的</td>
<td>成立，说明数据已经提交</td>
</tr>
</tbody></table>
<blockquote>
<p>Read Commited 隔离级别下，在事务中每一次执行快照读时生成ReadView。<br>Repeatable Read 隔离级别下，在事务中第一次执行快照读时生成ReadView，后续会复用。</p>
</blockquote>
</li>
</ul>
<h2 id="MySQL-管理"><a href="#MySQL-管理" class="headerlink" title="MySQL 管理"></a>MySQL 管理</h2><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><table>
<thead>
<tr>
<th>数据库</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mysql</td>
<td>存储MySQL服务器正常运行所需要的各种信息 （时区、主从、用户、权限等）</td>
</tr>
<tr>
<td>information_schema</td>
<td>提供了访问数据库元数据的各种表和视图，包含数据库、表、字段类型及访问权限等</td>
</tr>
<tr>
<td>performance_schema</td>
<td>为MySQL服务器运行时状态提供了一个底层监控功能，主要用于收集数据库服务器性能参数</td>
</tr>
<tr>
<td>sys</td>
<td>包含了一系列方便 DBA 和开发人员利用 performance_schema性能数据库进行性能调优和诊断的视图</td>
</tr>
</tbody></table>
<h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><ul>
<li><p>mysql<br>mysql客户端工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">语法 ：<br>  mysql [options] [database]<br>选项 ：<br>  -u, --user=name       <span class="hljs-comment">#指定用户名</span><br>  -p, --password[=name] <span class="hljs-comment">#指定密码</span><br>  -h, --host=name       <span class="hljs-comment">#指定服务器IP或域名</span><br>  -P, --port=port       <span class="hljs-comment">#指定连接端口</span><br>  -e, --execute=name    <span class="hljs-comment">#执行SQL语句并退出。方便执行批处理脚本</span><br>示例：<br>  mysql -uroot –p123456 study -e <span class="hljs-string">&quot;select * from tb_sku&quot;</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>mysqladmin<br>执行管理操作的客户端程序。可以用它来检查服务器的配置和当前状态、创建并删除数据库等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">语法:<br>  mysqladmin [options] <span class="hljs-built_in">command</span> ...<br>选项:<br>  -u, --user=name       <span class="hljs-comment">#指定用户名</span><br>  -p, --password[=name] <span class="hljs-comment">#指定密码</span><br>  -h, --host=name       <span class="hljs-comment">#指定服务器IP或域名</span><br>  -P, --port=port       <span class="hljs-comment">#指定连接端口</span><br>示例：<br>  mysqladmin -uroot –p1234 drop <span class="hljs-string">&#x27;test01&#x27;</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>mysqlbinlog<br>服务器生成的日志文件以二进制格式保存，需用mysqlbinlog查看这些文本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">语法 ：<br>  mysqlbinlog [options] log-files1 log-files2 ...<br>选项 ：<br>  -d, --database=name   <span class="hljs-comment">#指定数据库名称，只列出指定的数据库相关操作。</span><br>  -o, --offset=n        <span class="hljs-comment">#忽略掉日志中的前n行命令。</span><br>  -r,--result-file=name <span class="hljs-comment">#将输出的文本格式日志输出到指定文件。</span><br>  -s, --short-form      <span class="hljs-comment">#显示简单格式， 省略掉一些信息。</span><br>  --start-datatime=date1 --stop-datetime=date2  <span class="hljs-comment">#指定日期间隔内的所有日志。</span><br>  --start-position=pos1 --stop-position=pos2    <span class="hljs-comment">#指定位置间隔内的所有日志。</span><br>示例：<br>  mysqlbinlog -s binlog.00008<br></code></pre></td></tr></table></figure>
</li>
<li><p>mysqlshow<br>客户端对象查找工具，用来很快地查找存在哪些数据库、数据库中的表、表中的列或者索引。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">语法 ：<br>  mysqlshow [options] [db_name [table_name [col_name]]]<br>选项 ：<br>  --count   <span class="hljs-comment">#显示数据库及表的统计信息（数据库，表 均可以不指定）</span><br>  -i        <span class="hljs-comment">#显示指定数据库或者指定表的状态信息</span><br>示例：<br>  <span class="hljs-comment">#查询test库中book表的详细情况</span><br>  mysqlshow -uroot -p2143 <span class="hljs-built_in">test</span> book --count<br></code></pre></td></tr></table></figure>
</li>
<li><p>mysqldump<br>用来备份数据库或在不同数据库之间进行数据迁移。备份内容包含创建表，及插入表的SQL语句。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">语法 ：<br>  mysqldump [options] db_name [tables]<br>  mysqldump [options] --database/-B db1 [db2 db3...]<br>  mysqldump [options] --all-databases/-A<br>连接选项 ：<br>  -u, --user=name         <span class="hljs-comment">#指定用户名</span><br>  -p, --password[=name]   <span class="hljs-comment">#指定密码</span><br>  -h, --host=name         <span class="hljs-comment">#指定服务器ip或域名</span><br>  -P, --port=p            <span class="hljs-comment">#指定连接端口</span><br>输出选项：<br>  --add-drop-database     <span class="hljs-comment">#在每个数据库创建语句前加上 drop database 语句</span><br>  --add-drop-table        <span class="hljs-comment">#在每个表创建语句前加上 drop table 语句 , 默认开启 ; 不开启 (--skip-add-drop-table)</span><br>  -n, --no-create-db      <span class="hljs-comment">#不包含数据库的创建语句</span><br>  -t, --no-create-info    <span class="hljs-comment">#不包含数据表的创建语句</span><br>  -d, --no-data           <span class="hljs-comment">#不包含数据</span><br>  -T, --tab=name          <span class="hljs-comment">#自动生成两个文件：一个.sql文件，创建表结构的语句；一个.txt文件，数据文件</span><br>示例：<br>  mysqldump -uroot -p1234 -T D:/ db01 tb_score<br></code></pre></td></tr></table></figure>
</li>
<li><p>mysqlimport &#x2F; source<br>客户端数据导入工具，用来导入mysqldump 加 -T 参数后导出的文本文件。如果需要导入sql文件,可以使用mysql中的source 指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">语法：<br>  mysqlimport [options] db_name textfile1 [textfile2...]<br>  <span class="hljs-built_in">source</span> /root/xxxxx.sql<br>示例：<br>  mysqlimport -uroot -p2143 <span class="hljs-built_in">test</span> /tmp/city.txt<br></code></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="运维篇"><a href="#运维篇" class="headerlink" title="运维篇"></a>运维篇</h1><h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h3><p>错误日志是 MySQL 中最重要的日志之一，它记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。当数据库出现任何故障导致无法正常使用时，建议首先查看此日志。</p>
<p>查看错误日志位置：<br><code>show variables like &#39;%log_error%&#39;;</code></p>
<h3 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h3><p>二进制日志（BINLOG）记录了所有的DDL（数据定义语言）语句和DML（数据操纵语言）语句，但不包括数据查询（SELECT、SHOW）语句。默认开启。</p>
<p><strong>作用：</strong></p>
<ul>
<li>灾难时的数据恢复</li>
<li>MySQL的主从复制</li>
</ul>
<p><strong>查看参数：</strong><br>  <code>show variables like &#39;%log_bin%&#39;;</code><br>查询结果中：</p>
<ul>
<li>log_bin_basename：当前数据库服务器的binlog日志的前缀，具体文件名需要再加上编号(从000001开始)</li>
<li>log_bin_index：binlog的索引文件，记录了当前服务器关联的binlog文件有哪些</li>
</ul>
<p><strong>日志格式：</strong></p>
<table>
<thead>
<tr>
<th>格式</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>STATEMENT</td>
<td>基于SQL语句的日志记录，记录的是SQL语句，对数据进行修改的SQL都会记录在日志文件中。</td>
</tr>
<tr>
<td>ROW</td>
<td>基于行的日志记录，记录的是每一行的数据变更。（默认）</td>
</tr>
<tr>
<td>MIXED</td>
<td>混合了STATEMENT和ROW两种格式，默认采用STATEMENT，在某些特殊情况下会自动切换为ROW进行记录。</td>
</tr>
</tbody></table>
<p>通过<code>show variables like &#39;%binlog_format%;</code>查看</p>
<p><strong>日志查看：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysqlbinlog [ 参数选项 ] logfilename<br><br>参数选项：<br>  -d    <span class="hljs-comment">#指定数据库名称，只列出指定的数据库相关操作。</span><br>  -o    <span class="hljs-comment">#忽略掉日志中的前n行命令。</span><br>  -v    <span class="hljs-comment">#将行事件(数据变更)重构为SQL语句</span><br>  -vv   <span class="hljs-comment">#将行事件(数据变更)重构为SQL语句，并输出注释信息</span><br></code></pre></td></tr></table></figure>

<p><strong>清理日志：</strong></p>
<ul>
<li><code>reset master</code><br>删除全部 binlog 日志。删除之后，日志编号将从000001重新开始</li>
<li><code>purge master logs to &#39;binlog.*&#39;</code><br>删除 * 编号之前的所有日志</li>
<li><code>purge master logs before &#39;yyyy-mm-dd hh24:mi:ss&#39;</code><br>删除”yyyy-mm-dd hh24:mi:ss” 之前产生的所有日志</li>
</ul>
<p>也可以在mysql的配置文件中配置二进制日志的过期时间，日志过期会自动删除:<br>  <code>show variables like &#39;%binlog_expire_logs_seconds%&#39;;</code></p>
<h3 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h3><p>查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的SQL语句。<br>查询日志默认未开启，如需开启修改配置文件。开启查询日志后，所有客户端的增删改查操作都会记录在该日志文件中，长时间运行该日志文件将会非常大。</p>
<p>查看参数：<br>  <code>show variables like &#39;%general%&#39;;</code></p>
<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><p>慢查询日志记录了所有执行时间超过参数<code>long_query_time</code>设置值并且扫描记录数不小于<code>min_examined_row_limit</code>的所有的SQL语句的日志，<code>long_query_time</code>默认为10秒，最小为0，精度可以到微秒。且默认情况下不会记录管理语句，也不会记录不使用索引进行查找的查询。<br>慢查询日志默认未开启，如需开启修改配置文件。</p>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>主从复制是指将主数据库 Master 的 DDL 和 DML 操作通过二进制日志传到从库服务器 Slave 中，然后在从库上对这些日志重新执行（重做），从而使得从库和主库的数据保持同步。</p>
<p>MySQL支持一台主库同时向多台从库进行复制，从库同时也可以作为其他从服务器的主库，实现链状复制。</p>
<p><strong>作用：</strong></p>
<ul>
<li>主库出现问题，可以快速切换到从库提供服务</li>
<li>实现读写分离，降低主库的访问压力</li>
<li>可以在从库中执行备份，以避免备份期间影响主库服务</li>
</ul>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>MySQL主从复制的核心是二进制日志，过程如图：</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png" srcset="/img/loading.gif" lazyload class="" title="alt 主从复制">

<p>具体分成三步：</p>
<ol>
<li>Master 主库在事务提交时，会把数据变更记录在二进制日志文件 binlog 中。</li>
<li>从库读取主库的二进制日志文件 binlog ，写入到从库的中继日志 Relay Log 。</li>
<li>slave重做中继日志中的事件，将改变反映它自己的数据。</li>
</ol>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><ol>
<li>准备两个MySQL服务</li>
<li>配置主库<br><code>show master status</code> 查看二进制坐标</li>
<li>配置从库<br><code>change master to master_host=*, master_user=*,master_password=*, master_log_file=*, master_log_pos=*;</code><table>
<thead>
<tr>
<th>参数名</th>
<th>含义</th>
<th>8.0.23之前</th>
</tr>
</thead>
<tbody><tr>
<td>SOURCE_HOST</td>
<td>主库IP地址</td>
<td>MASTER_HOST</td>
</tr>
<tr>
<td>SOURCE_USER</td>
<td>连接主库的用户名</td>
<td>MASTER_USER</td>
</tr>
<tr>
<td>SOURCE_PASSWORD</td>
<td>连接主库的密码</td>
<td>MASTER_PASSWORD</td>
</tr>
<tr>
<td>SOURCE_LOG_FILE</td>
<td>binlog 日志文件名</td>
<td>MASTER_LOG_FILE</td>
</tr>
<tr>
<td>SOURCE_LOG_POS</td>
<td>binlog 日志文件位置</td>
<td>MASTER_LOG_POS</td>
</tr>
</tbody></table>
</li>
<li>开启同步<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 8.0.22之后：</span><br><span class="hljs-keyword">start</span> replica;<br><span class="hljs-comment">-- 8.0.22之前：</span><br><span class="hljs-keyword">start</span> slave;<br></code></pre></td></tr></table></figure></li>
<li>查看主从同步状态<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 8.0.22之后：</span><br><span class="hljs-keyword">start</span> replica status;<br><span class="hljs-comment">-- 8.0.22之前：</span><br><span class="hljs-keyword">start</span> slave status;<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>随着互联网及移动互联网的发展，应用系统的数据量也是成指数式增长，若采用单数据库进行数据存储，存在以下性能瓶颈：</p>
<ul>
<li>IO瓶颈<br>热点数据太多，数据库缓存不足，产生大量磁盘IO，效率较低。请求数据太多，带宽不够，网络IO瓶颈。</li>
<li>CPU瓶颈<br>排序、分组、连接查询、聚合统计等SQL会耗费大量的CPU资源，请求数太多，CPU出现瓶颈。</li>
</ul>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload class="" title="alt 分库分表示意图">

<p>为了解决上述问题，需要对数据库进行分库分表处理。其中心思想是将数据分散存储，使得单一数据库&#x2F;表的数据量变小来缓解单一数据库的性能瓶颈问题，从而达到提升数据库性能的效果。</p>
<h3 id="拆分策略"><a href="#拆分策略" class="headerlink" title="拆分策略"></a>拆分策略</h3><p>按形式分为垂直拆分、水平拆分。按粒度分为分库和分表，因此共四种拆分策略。<br>在业务系统中，为了缓解磁盘IO及CPU的性能瓶颈，到底是垂直拆分，还是水平拆分；具体是分库，还是分表，都需要根据具体的业务需求具体分析。</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E6%8B%86%E5%88%86%E7%AD%96%E7%95%A5.png" srcset="/img/loading.gif" lazyload class="" title="alt 拆分策略">

<ul>
<li><p>垂直分库<br>以表为依据，根据业务将不同表拆分到不同库中。<br>特点：</p>
<ul>
<li>每个库的表结构都不一样</li>
<li>每个库的数据也不一样</li>
<li>所有库的并集是全量数据</li>
</ul>
</li>
<li><p>垂直分表<br>以字段为依据，根据字段属性将不同字段拆分到不同表中。<br>特点：</p>
<ul>
<li>每个表的结构都不一样</li>
<li>每个表的数据也不一样，一般通过主键&#x2F;外键关联</li>
<li>所有表的并集是全量数据</li>
</ul>
</li>
<li><p>水平分库<br>以字段为依据，按照一定策略，将一个库的数据拆分到多个库中。<br>特点：</p>
<ul>
<li>每个库的表结构都一样</li>
<li>每个库的数据都不一样</li>
<li>所有库的并集是全量数据</li>
</ul>
</li>
<li><p>水平分表<br>以字段为依据，按照一定策略，将一个表的数据拆分到多个表中。<br>特点：</p>
<ul>
<li>每个库的表结构都一样</li>
<li>每个库的数据都不一样</li>
<li>所有库的并集是全量数据</li>
</ul>
</li>
</ul>
<h3 id="实现技术-MyCat"><a href="#实现技术-MyCat" class="headerlink" title="实现技术 - MyCat"></a>实现技术 - MyCat</h3><ul>
<li>shardingJDBC：基于AOP原理，在应用程序中对本地执行的SQL进行拦截，解析、改写、路由处理。需要自行编码配置实现，只支持java语言，性能较高。</li>
<li>MyCat：数据库分库分表中间件，不用调整代码即可实现分库分表，支持多种语言，性能不及前者。</li>
</ul>
<p>以下介绍以MyCat为例。</p>
<h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><p>Mycat是开源的、活跃的、基于Java语言编写的MySQL数据库中间件。可以像使用mysql一样来使用mycat，对于开发人员来说根本感觉不到mycat的存在，开发人员只需要连接MyCat即可，而具体底层用到几台数据库，每一台数据库服务器里面存储了什么数据，都无需关心。 具体的分库分表的策略，只需要在MyCat中配置即可。</p>
<p>优势：</p>
<ul>
<li>性能可靠稳定</li>
<li>强大的技术团队</li>
<li>体系完善</li>
<li>社区活跃</li>
</ul>
<h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MyCat%E6%A6%82%E5%BF%B5%E5%9B%BE.png" srcset="/img/loading.gif" lazyload class="" title="alt MyCat概念图">

<p>MyCat的逻辑结构主要包括逻辑库、逻辑表、分片规则、分片节点。而具体的数据存储还是在物理结构，也就是数据库服务器中存储的。</p>
<h4 id="分片规则"><a href="#分片规则" class="headerlink" title="分片规则"></a>分片规则</h4><ul>
<li>范围分片：根据指定的字段及其配置的范围与数据节点的对应情况来决定数据属于哪一个分片</li>
<li>取模分片：根据指定的字段值与节点数量进行求模运算，根据运算结果决定该数据属于哪一个分片</li>
<li>一致性Hash分片：相同的哈希因子计算值总是被划分到相同的分区表中</li>
<li>枚举分片：通过在配置文件中配置可能的枚举值, 指定数据分布到不同数据节点上。适用于按照省份、性别、状态拆分数据等业务</li>
<li>应用指定算法：运行阶段由应用自主决定路由到哪个分片，直接根据字符子串（必须是数字）计算分片号</li>
<li>固定分片Hash算法：指定二进制位进行与运算</li>
<li>字符串Hash解析算法：截取字符串中的指定位置的子字符串，进行hash算法，算出分片</li>
<li>按天分片算法：按照日期及对应的时间周期分片</li>
<li>自然月分片：按照月份来分片，每个自然月为一个分片</li>
</ul>
<h4 id="管理与监控"><a href="#管理与监控" class="headerlink" title="管理与监控"></a>管理与监控</h4><ul>
<li>执行原理：<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/MyCat%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86.png" srcset="/img/loading.gif" lazyload class="" title="alt MyCat执行原理"></li>
<li>Mycat-web（Mycat-eye）是 Mycat 可视化运维的管理和监控平台，引入ZooKeeper作为配置中心，可以管理多个节点</li>
<li>Mycat-web 管理和监控 Mycat 的流量、连接、活动线程和内存等，具备 IP 白名单、邮件告警等模块，还可以统计 SQL 并分析慢 SQL 和高频 SQL 等，为优化 SQL 提供依据</li>
</ul>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p>读写分离是把对数据库的读和写操作分开,以对应不同的数据库服务器。主数据库提供写操作，从数据库提供读操作，这样能有效地减轻单台数据库的压力。</p>
<p>例如用MyCat实现的一主一从读写分离示意图：</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E4%B8%BB%E4%BB%8E%E5%88%86%E7%A6%BB%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload class="" title="alt 主从分离示意图">

<p>将写操作分配到 Master 上，读操作分配到 Slave 上，实现负载均衡。但这种方案如果 Master 宕机，那么业务系统就只能读不能写了，因此可以引入双主双从：</p>
<img src="/2022/12/03/MySQL-%E7%AC%94%E8%AE%B0/%E5%8F%8C%E4%B8%BB%E5%8F%8C%E4%BB%8E%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload class="" title="alt 双主双从示意图">

<p>一个主机 Master1 用于处理所有写请求，它的从机 Slave1 和另一台主机 Master2 还有它的从机 Slave2 负责所有读请求。当 Master1 主机宕机后，Master2 主机负责写请求，Master1、Master2 互为备机。</p>
<hr>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><table>
<thead>
<tr>
<th>类型名称</th>
<th>取值范围</th>
<th>大小</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>-128〜127</td>
<td>1个字节</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>-32768〜32767</td>
<td>2个宇节</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>-8388608〜8388607</td>
<td>3个字节</td>
</tr>
<tr>
<td>INT (INTEGHR)</td>
<td>-2147483648〜2147483647</td>
<td>4个字节</td>
</tr>
<tr>
<td>BIGINT</td>
<td>-9223372036854775808〜9223372036854775807</td>
<td>8个字节</td>
</tr>
</tbody></table>
<p>无符号在数据类型后加 unsigned 关键字。</p>
<h3 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h3><table>
<thead>
<tr>
<th>类型名称</th>
<th>说明</th>
<th>存储需求</th>
</tr>
</thead>
<tbody><tr>
<td>FLOAT</td>
<td>单精度浮点数</td>
<td>4 个字节</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>双精度浮点数</td>
<td>8 个字节</td>
</tr>
<tr>
<td>DECIMAL (M, D)，DEC</td>
<td>压缩的“严格”定点数</td>
<td>M+2 个字节</td>
</tr>
</tbody></table>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><table>
<thead>
<tr>
<th>类型名称</th>
<th>说明</th>
<th>存储需求</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR(M)</td>
<td>固定长度字符串</td>
<td>M 字节，1&lt;&#x3D;M&lt;&#x3D;255</td>
</tr>
<tr>
<td>VARCHAR(M)</td>
<td>变长字符串</td>
<td>L+1字节，在此，L&lt; &#x3D; M和 1&lt;&#x3D;M&lt;&#x3D;255</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>短文本字符串</td>
<td>L+1字节，在此，L&lt;2^8</td>
</tr>
<tr>
<td>TEXT</td>
<td>长文本字符串</td>
<td>L+2字节，在此，L&lt;2^16</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>中等长度文本数据</td>
<td>L+3字节，在此，L&lt;2^24</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>极大文本数据</td>
<td>L+4字节，在此，L&lt;2^32</td>
</tr>
<tr>
<td>ENUM</td>
<td>枚举类型，只能有一个枚举字符串值</td>
<td>1或2个字节，取决于枚举值的数目 (最大值为65535)</td>
</tr>
<tr>
<td>SET</td>
<td>一个设置，字符串对象可以有零个或 多个SET成员</td>
<td>1、2、3、4或8个字节，取决于集合 成员的数量（最多64个成员）</td>
</tr>
</tbody></table>
<p>一般定长的效率要高于变长字符串</p>
<h3 id="二进制类型"><a href="#二进制类型" class="headerlink" title="二进制类型"></a>二进制类型</h3><table>
<thead>
<tr>
<th>类型名称</th>
<th>说明</th>
<th>存储需求</th>
</tr>
</thead>
<tbody><tr>
<td>BIT(M)</td>
<td>位字段类型</td>
<td>大约 (M+7)&#x2F;8 字节</td>
</tr>
<tr>
<td>BINARY(M)</td>
<td>固定长度二进制字符串</td>
<td>M 字节</td>
</tr>
<tr>
<td>VARBINARY (M)</td>
<td>可变长度二进制字符串</td>
<td>M+1 字节</td>
</tr>
<tr>
<td>TINYBLOB (M)</td>
<td>非常小的BLOB</td>
<td>L+1 字节，在此，L&lt;2^8</td>
</tr>
<tr>
<td>BLOB (M)</td>
<td>小 BLOB</td>
<td>L+2 字节，在此，L&lt;2^16</td>
</tr>
<tr>
<td>MEDIUMBLOB (M)</td>
<td>中等大小的BLOB</td>
<td>L+3 字节，在此，L&lt;2^24</td>
</tr>
<tr>
<td>LONGBLOB (M)</td>
<td>非常大的BLOB</td>
<td>L+4 字节，在此，L&lt;2^32</td>
</tr>
</tbody></table>
<h3 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h3><table>
<thead>
<tr>
<th>类型名称</th>
<th>日期格式</th>
<th>日期范围</th>
<th>存储需求</th>
</tr>
</thead>
<tbody><tr>
<td>YEAR</td>
<td>YYYY</td>
<td>1901 ~ 2155</td>
<td>1 个字节</td>
</tr>
<tr>
<td>TIME</td>
<td>HH:MM:SS</td>
<td>-838:59:59 ~ 838:59:59</td>
<td>3 个字节</td>
</tr>
<tr>
<td>DATE</td>
<td>YYYY-MM-DD</td>
<td>1000-01-01 ~ 9999-12-3</td>
<td>3 个字节</td>
</tr>
<tr>
<td>DATETIME</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td>
<td>8 个字节</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1970-01-01 00:00:01 ~ 2038-01-19 03:14:07</td>
<td>4 个字节</td>
</tr>
</tbody></table>
<h2 id="权限一览表"><a href="#权限一览表" class="headerlink" title="权限一览表"></a>权限一览表</h2><blockquote>
<p>具体权限的作用详见<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html" title="官方文档">官方文档</a></p>
</blockquote>
<p>GRANT 和 REVOKE 允许的静态权限</p>
<table>
<thead>
<tr>
<th align="left">Privilege</th>
<th align="left">Grant Table Column</th>
<th align="left">Context</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_all"><code>ALL [PRIVILEGES]</code></a></td>
<td align="left">Synonym for “all privileges”</td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter"><code>ALTER</code></a></td>
<td align="left"><code>Alter_priv</code></td>
<td align="left">Tables</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter-routine"><code>ALTER ROUTINE</code></a></td>
<td align="left"><code>Alter_routine_priv</code></td>
<td align="left">Stored routines</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create"><code>CREATE</code></a></td>
<td align="left"><code>Create_priv</code></td>
<td align="left">Databases, tables, or indexes</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-role"><code>CREATE ROLE</code></a></td>
<td align="left"><code>Create_role_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-routine"><code>CREATE ROUTINE</code></a></td>
<td align="left"><code>Create_routine_priv</code></td>
<td align="left">Stored routines</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-tablespace"><code>CREATE TABLESPACE</code></a></td>
<td align="left"><code>Create_tablespace_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-temporary-tables"><code>CREATE TEMPORARY TABLES</code></a></td>
<td align="left"><code>Create_tmp_table_priv</code></td>
<td align="left">Tables</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-user"><code>CREATE USER</code></a></td>
<td align="left"><code>Create_user_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-view"><code>CREATE VIEW</code></a></td>
<td align="left"><code>Create_view_priv</code></td>
<td align="left">Views</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_delete"><code>DELETE</code></a></td>
<td align="left"><code>Delete_priv</code></td>
<td align="left">Tables</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop"><code>DROP</code></a></td>
<td align="left"><code>Drop_priv</code></td>
<td align="left">Databases, tables, or views</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop-role"><code>DROP ROLE</code></a></td>
<td align="left"><code>Drop_role_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_event"><code>EVENT</code></a></td>
<td align="left"><code>Event_priv</code></td>
<td align="left">Databases</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_execute"><code>EXECUTE</code></a></td>
<td align="left"><code>Execute_priv</code></td>
<td align="left">Stored routines</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_file"><code>FILE</code></a></td>
<td align="left"><code>File_priv</code></td>
<td align="left">File access on server host</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_grant-option"><code>GRANT OPTION</code></a></td>
<td align="left"><code>Grant_priv</code></td>
<td align="left">Databases, tables, or stored routines</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_index"><code>INDEX</code></a></td>
<td align="left"><code>Index_priv</code></td>
<td align="left">Tables</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_insert"><code>INSERT</code></a></td>
<td align="left"><code>Insert_priv</code></td>
<td align="left">Tables or columns</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_lock-tables"><code>LOCK TABLES</code></a></td>
<td align="left"><code>Lock_tables_priv</code></td>
<td align="left">Databases</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_process"><code>PROCESS</code></a></td>
<td align="left"><code>Process_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_proxy"><code>PROXY</code></a></td>
<td align="left">See <code>proxies_priv</code> table</td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_references"><code>REFERENCES</code></a></td>
<td align="left"><code>References_priv</code></td>
<td align="left">Databases or tables</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_reload"><code>RELOAD</code></a></td>
<td align="left"><code>Reload_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-client"><code>REPLICATION CLIENT</code></a></td>
<td align="left"><code>Repl_client_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave"><code>REPLICATION SLAVE</code></a></td>
<td align="left"><code>Repl_slave_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_select"><code>SELECT</code></a></td>
<td align="left"><code>Select_priv</code></td>
<td align="left">Tables or columns</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-databases"><code>SHOW DATABASES</code></a></td>
<td align="left"><code>Show_db_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-view"><code>SHOW VIEW</code></a></td>
<td align="left"><code>Show_view_priv</code></td>
<td align="left">Views</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_shutdown"><code>SHUTDOWN</code></a></td>
<td align="left"><code>Shutdown_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_super"><code>SUPER</code></a></td>
<td align="left"><code>Super_priv</code></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_trigger"><code>TRIGGER</code></a></td>
<td align="left"><code>Trigger_priv</code></td>
<td align="left">Tables</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_update"><code>UPDATE</code></a></td>
<td align="left"><code>Update_priv</code></td>
<td align="left">Tables or columns</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_usage"><code>USAGE</code></a></td>
<td align="left">Synonym for “no privileges”</td>
<td align="left">Server administration</td>
</tr>
</tbody></table>
<p>GRANT 和 REVOKE 允许的动态权限</p>
<table>
<thead>
<tr>
<th align="left">Privilege</th>
<th align="left">Context</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_application-password-admin"><code>APPLICATION_PASSWORD_ADMIN</code></a></td>
<td align="left">Dual password administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_audit-abort-exempt"><code>AUDIT_ABORT_EXEMPT</code></a></td>
<td align="left">Allow queries blocked by audit log filter</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_audit-admin"><code>AUDIT_ADMIN</code></a></td>
<td align="left">Audit log administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_authentication-policy-admin"><code>AUTHENTICATION_POLICY_ADMIN</code></a></td>
<td align="left">Authentication administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_backup-admin"><code>BACKUP_ADMIN</code></a></td>
<td align="left">Backup administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_binlog-admin"><code>BINLOG_ADMIN</code></a></td>
<td align="left">Backup and Replication administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_binlog-encryption-admin"><code>BINLOG_ENCRYPTION_ADMIN</code></a></td>
<td align="left">Backup and Replication administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_clone-admin"><code>CLONE_ADMIN</code></a></td>
<td align="left">Clone administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_connection-admin"><code>CONNECTION_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_encryption-key-admin"><code>ENCRYPTION_KEY_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-admin"><code>FIREWALL_ADMIN</code></a></td>
<td align="left">Firewall administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-exempt"><code>FIREWALL_EXEMPT</code></a></td>
<td align="left">Firewall administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-user"><code>FIREWALL_USER</code></a></td>
<td align="left">Firewall administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-optimizer-costs"><code>FLUSH_OPTIMIZER_COSTS</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-status"><code>FLUSH_STATUS</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-tables"><code>FLUSH_TABLES</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-user-resources"><code>FLUSH_USER_RESOURCES</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_group-replication-admin"><code>GROUP_REPLICATION_ADMIN</code></a></td>
<td align="left">Replication administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_group-replication-stream"><code>GROUP_REPLICATION_STREAM</code></a></td>
<td align="left">Replication administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_innodb-redo-log-archive"><code>INNODB_REDO_LOG_ARCHIVE</code></a></td>
<td align="left">Redo log archiving administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_ndb-stored-user"><code>NDB_STORED_USER</code></a></td>
<td align="left">NDB Cluster</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_passwordless-user-admin"><code>PASSWORDLESS_USER_ADMIN</code></a></td>
<td align="left">Authentication administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_persist-ro-variables-admin"><code>PERSIST_RO_VARIABLES_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-applier"><code>REPLICATION_APPLIER</code></a></td>
<td align="left"><code>PRIVILEGE_CHECKS_USER</code> for a replication channel</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave-admin"><code>REPLICATION_SLAVE_ADMIN</code></a></td>
<td align="left">Replication administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_resource-group-admin"><code>RESOURCE_GROUP_ADMIN</code></a></td>
<td align="left">Resource group administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_resource-group-user"><code>RESOURCE_GROUP_USER</code></a></td>
<td align="left">Resource group administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_role-admin"><code>ROLE_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_session-variables-admin"><code>SESSION_VARIABLES_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_set-user-id"><code>SET_USER_ID</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-routine"><code>SHOW_ROUTINE</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_system-user"><code>SYSTEM_USER</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_system-variables-admin"><code>SYSTEM_VARIABLES_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_table-encryption-admin"><code>TABLE_ENCRYPTION_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_version-token-admin"><code>VERSION_TOKEN_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_xa-recover-admin"><code>XA_RECOVER_ADMIN</code></a></td>
<td align="left">Server administration</td>
</tr>
</tbody></table>
<h2 id="图形化界面工具"><a href="#图形化界面工具" class="headerlink" title="图形化界面工具"></a>图形化界面工具</h2><ul>
<li>Workbench(免费): <a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/workbench/">http://dev.mysql.com/downloads/workbench/</a></li>
<li>navicat(收费，试用版30天): <a target="_blank" rel="noopener" href="https://www.navicat.com/en/download/navicat-for-mysql">https://www.navicat.com/en/download/navicat-for-mysql</a></li>
<li>Sequel Pro(开源免费，仅支持Mac OS): <a target="_blank" rel="noopener" href="http://www.sequelpro.com/">http://www.sequelpro.com/</a></li>
<li>HeidiSQL(免费): <a target="_blank" rel="noopener" href="http://www.heidisql.com/">http://www.heidisql.com/</a></li>
<li>phpMyAdmin(免费): <a target="_blank" rel="noopener" href="https://www.phpmyadmin.net/">https://www.phpmyadmin.net/</a></li>
<li>SQLyog: <a target="_blank" rel="noopener" href="https://sqlyog.en.softonic.com/">https://sqlyog.en.softonic.com/</a></li>
</ul>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><blockquote>
<p>[1] <a target="_blank" rel="noopener" href="https://dhc.pythonanywhere.com/entry/share/?key=3ad29aad765a2b98b2b2a745d71bef715507ee9db8adbec98257bac0ad84cbe4#h1-u6743u9650u4E00u89C8u8868">https://dhc.pythonanywhere.com/entry/share/?key=3ad29aad765a2b98b2b2a745d71bef715507ee9db8adbec98257bac0ad84cbe4#h1-u6743u9650u4E00u89C8u8868</a><br>[2] <a target="_blank" rel="noopener" href="https://github.com/Buildings-Lei/mysql_note/blob/main/README.md">https://github.com/Buildings-Lei/mysql_note/blob/main/README.md</a><br>[3] <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kr4y1i7ru?share_source=copy_web">https://www.bilibili.com/video/BV1Kr4y1i7ru?share_source=copy_web</a></p>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MySQL/">#MySQL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MySQL-笔记</div>
      <div>https://chanpero.github.io/2022/12/03/MySQL-笔记/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>chanper</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年12月3日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-nc"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                    <i class="iconfont icon-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/12/31/LeetCode-%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%E8%A7%A3%E5%86%B3%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E9%97%AE%E9%A2%98/" title="LeetCode-回溯算法解决排列组合问题">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">LeetCode-回溯算法解决排列组合问题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/11/20/Java-%E5%B9%B6%E5%8F%91/" title="Java-并发">
                        <span class="hidden-mobile">Java-并发</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'chanpero/commit-utterances');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
